---
title: "R4H2O: Level 1"
subtitle: "Level One"
date: "`r format(Sys.Date(), '%d %B %Y')`"
output: 
    revealjs::revealjs_presentation:
        self_contained: false
        theme: league
        highlight: zenburn
        smart: true
        css: style.css
        reveal_options:
            previewLinks: true
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE, dpi=300)
```

# {data-background="../images/r4h2o-banner.jpg"}

## Learning Objectives Level 1
- Apply the principles of strategic data science to solve water problems
- Write R code to load, analyse, and visualise data
- Diagnose water quality data with descriptive statistics
- Develop presentations, reports, and applications to share results
     
## Course Book

![](../images/r4h2o-cover-3d.png)

## Program Level 1
<div class="cols">
1. Principles of Data Science
2. Basics of the R Language
3. Case Study: Channel flows
4. Case Study: Water quality data
    - Reading CSV and Spreadsheet data
    - Descriptive Statistics

5. Visualise data with _ggplot2_
6. Data science workflow
7. Creating data products
</div>
<div class="cols">
![](../images/2019-workshop-melbourne.jpg)
</div>
# Introductions
![](../images/data-science-evolution.png)

# Data Science Learning Curve
![](../images/r-learning-curve.jpg){height=500}

# Principles of Data Science
![](../images/strategic-data-science.png)

## What is Data Science?
<div class="cols">
![](../images/conway.png){height=400}

<small>Conway Venn Diagram ([drewconway.com](http://drewconway.com/zia/2013/3/26/the-data-science-venn-diagram)).</small>
</div>
<div class="cols">
> Many data scientists have published modifications of this model. Can you think of some other competencies for data scientists?
</div>

## Don't Believe the Hype
![](../images/sexiest-job.png)

<small>Source: _Harvard Business Review_.</small>

## What is Good Data Science?
![](../images/vitruvius.png){height=400}

<small>Vitrivian triangle (_venustas_, _firmitas_, _utilitas_)</small>

## What is Useful Data Science?
![](../images/feedback-loop.png)

## Spreadsheets are Chaos
![](../images/reverse-engineer-spreadsheet.jpg)

## Code is Poetry: R
```{r echo=TRUE}
library(readr)
library(dplyr)
labdata <- readr::read_csv("data/water_quality.csv")
group_by(labdata, Measure) %>% 
    summarise(min = min(Result),
              mean = mean(Result),
              sd = sd(Result))
```

## Code is Poetry: Python
```{python echo=TRUE}
import pandas as pd
import numpy as np
labdata = pd.read_csv("data/water_quality.csv")
 
labdata.groupby("Measure")["Result"].agg([np.min, np.mean, np.std])
```

# Basics of the R Language
![](../images/rstudio.png)

## Desktop version
1. Download and install _R_ and _RStudio_
2. On Windows, install _RTools_
2. Download course materials
   - [github.com/pprevos/r4h2o](https://github.com/pprevos/r4h2o)
3. Unzip folder
4. In RStudio: _File_ > _Open Project_
5. Open `r4h2o.Rproj`

## Cloud Version
1. Register at [cloud.rstudio.com](https://cloud.rstudio.com)
2. _New Project_ > _New Project From Github Repo_
    - `https://github.com/pprevos/r4h2o/`
4. RStudio will download the project files

## Principles of R
- Console (REPL: Read-Eval-Print Loop)
- Mathematical operators (`+ - * ^ %% %/%`)
- Variable assignment
- Assignment operator (`<-` versus `=`)
- Functions: `sum()`, `prod()`, `abs()`, `log(a, base = b)`
  - Parameters
  - Use `=` sign
  - Auto-completion
  
## BODMAS
![](../images/memes.jpg)

```{r, echo=TRUE}
3 - 3 * 6 + 2
```

## Arithmetic
```{r, echo=TRUE}
diameter <- 150
pipe_area <- (pi / 4) * (diameter / 1000)^2
pipe_area
sqrt(pipe_area / (pi / 4)) * 1000
```

## Vectors
```{r, echo=TRUE, results='hide'}
complaints <- c(12, 13, 23, 45, 22, 99, 31)

sum(complaints)
prod(complaints)
abs(complaints)
exp(complaints)
factorial(complaints)
log(complaints, base = 3)
log10(complaints)
```

## Basic Plotting 1
```{r}
par(mar = c(4, 4, 2, 1))
```

```{r, echo=TRUE, fig.width=6, fig.height=2.5}
diameter <- 50:350
pipe_area <- (pi / 4) * (diameter / 1000)^2
plot(diameter, pipe_area, type = "l", col = "blue", main = "Pipe Area")
abline(v = 150, col = "grey", lty = 2)
abline(h = (pi / 4) * (150 / 1000)^2, col = "grey", lty = 2)
points(150, (pi / 4) * (150 / 1000)^2, col = "red")
```


## Coding Principles
![](../images/computer-bug.png){width="100%"}
<small>First computer bug (1947)</small>

Open: `scripts/02-basics.R`

## Variable Names
Use meaningful variable names and use a consistent naming convention

- `flowdaily`: All lowercase
- `flow.daily`: Period-separated
- `flow_daily`: Snake case
- `flowDaily`: Camel case
- `FlowDaily`: Upper camel case

## Bugs
- Debugging (step through code)
- Typos (lintr)
- Look at indentation
- Error messages (copy and paste into search engine)
- Help files

## Scripts and Projects
- Working Directory
- Open Script
- Commenting
- Indentation

## R4H2O Cheat Sheet
![](../images/r4h2o-cheat-sheet.png){height=500}

# Case Study 0: Channel Flow {data-background="../images/open-channel.jpg"}

## Discharge formula
<div class="cols">
$$Q = \frac{2}{3} C_d \sqrt{2g} \; lh^\frac{3}{2}$$

- $Q$: Discharge in m^3^/s
- $C_d$: Discharge coefficient
- $g$: Acceleration of gravity
- $l$: Crest length [m]
- h: Head above crest [m]
</div>
<div class="cols">
![](../images/rectangular-weir.png)
</div>

## Coding Practice
<div class="column" style="float:left; width: 50%">
Create an R script and answer:

1. What is the flow ($Q$) in the channel in m^3^/s when the height $h = 100$ mm?
2. What is the average flow for these three heights: 150mm, 136mm, 75mm, in litres per second?
3. Plot the flow in m^3^/s for all heights between 50mm and 500mm.
</div>

<div class="column" style="float:right; width: 50%">
$Q = \frac{2}{3} C_d \sqrt{2g} \; lh^\frac{3}{2}$

- $C_d C_d=0.62$
- $g = 9.81 m/s^2$
- $l = 0.5 m$
</div>

## Solution

`scripts/case-study-0.R`

```{r, echo=TRUE}
# Define constants

cd <- 0.62
g <- 9.81
b <- 0.5

# Question 1
# Flow in m3/2 when h = 100 mm

h1 <- 100 / 1000
q1 <- (2 / 3) * cd * sqrt(2 * g) * b * h1^(3 / 2)
q1
```

# 
![](../images/coffee.jpg)

# Exploring Data with Tidyverse
![](../images/tidyverse.png)

## Base R functions
  - Basic programming functions
  - Arithmetic
  - Statistics
  - Plotting
  - Extensible with functions (packages)

## R Packages
- Packages to extend base functionality
  - Distributed mainly through [CRAN](https://cran.r-project.org/)
  - Comprehensive R Archive Network
- Install with `install.packages("dplyr")`
- Call library to access functions: `library(dplyr)`
- Or, add library name and two colons: `dplyr::filter()`

## Tidyverse
<div class="cols">
- Collection of R packages
- Easy data manipulation
- 'syntactic sugar'
- Activate with `library(tidyverse)` or individual packages

_Install the Tidyverse packages on your (cloud) computer_
</div>
<div class="cols">
![](../images/tidyverse.png)
</div>

# Case Study 1: Water Quality
```{r, fig.asp=9/16}
library(tidyverse)
library(lubridate)
labdata_2069 <- read_csv("data/water_quality.csv") %>% 
    filter(year(Date) == 2069 & Suburb == "Hallburgh")

ggplot(labdata_2069, aes(Date, Result)) + 
    geom_line(alpha = 0.9, col = "dodgerblue") + 
    facet_wrap(~Measure, scales = "free_y") + 
    theme_minimal() + 
    labs(title = "Water Quality Data Gormsey",
         subtitle = unique(labdata_2069$Suburb),
         caption = "R4H2O")
```

## Obtaining Data
- Database (SQL, Oracle)
- Desktop files (spreadsheets, CSV)
- Web (HTML, XML, JSON)
  - API
  - Scraping

## Reading CSV files
- `readr` package for CSV files (part of Tidyverse)
    - `read_csv()` faster alternative for `read.csv()`
    - Look at help text

- File names in R:
  - Unix-based (slash instead of backslash)
  
```{r, echo = TRUE}
# CSV Files
library(readr)
labdata <- read_csv("data/water_quality.csv")

# Reading Excel spreadsheets
labdata <- readxl::read_excel("data/water_quality.xlsx", 
                              skip = 2, sheet = "data")
```
Open `scripts/03-data-frames.R`

## Variable Classes
- Integer (${\ldots -3, -2, -1, 0, 1, 2, 3, \ldots}$)
- Numeric (Real numbers) ($\mathbb{R}$)
- Complex numbers ($a + bi$)
- Text (`"abcd"`)
- Dates (`"`r Sys.Date()`"`)
- Factors (classifications): (`"Male", "Female", "Other"`)
- Boolean (`TRUE`, `FALSE`)

## Variable Types
![](../images/variable-types.png)

Scalar, vector and data frame / tibble (matrix)

## Explore Data Frame Properties

```{r,echo=TRUE, results='hide'}
names(labdata)
dim(labdata)
ncol(labdata)
nrow(labdata)

head(labdata)
str(labdata)
glimpse(labdata)
```

## Exploring data frames
- `df[rows, columns]`
- `df$column`
- `glimpse(df)`

```{r, echo=TRUE, results='hide'}
labdata[12:13, ]
labdata[, 4:5]
labdata[1:2, c(2, 4:5, 6)]
labdata[1:2, c(-1, -3, -7)]
labdata$Date[1:6]
```

What is the sample number of the last sample in the Gormsey data? 

Hint, use the `nrow()` function.

## Conditionals
Compare variables

```{r, echo = TRUE, results='hide'}
a <- 1:2
a == 1
a != 1
a >= 2

a <- c(TRUE, FALSE)
a * 2

"small" > "large" 

labdata$Measure == "Turbidity" & labdata$Result > 5
```

## Filtering
![](../images/filter.png)

```{r, echo=TRUE, results='hide'}
# Three methods

labdata[labdata$Measure == "Turbidity", ]

subset(labdata, Measure == "Turbidity")

library(dplyr)
filter(labdata, Measure == "Turbidity")

turb5 <- filter(labdata, Measure == "Turbidity" & Result > 5)
```

## Counting Results
```{r, echo=TRUE}
length(labdata$Measure)

unique(labdata$Measure)

table(labdata$Measure)
```

## dplyr counting
```{r, echo=TRUE}
turbidity <- filter(labdata, Measure == "Turbidity")
turbidity_count <- count(turbidity, Suburb, name = "Samples")
turbidity_count
```

## Coding Practice
Write a script to answer these questions:

1. Create a table of the number of E. coli regulation breaches by suburb (`Result > 0`).
2. Which sample point has the most number of samples taken?
3. On how many days were samples taken?

Solutions in `scripts/case-study-1.R`

# Descriptive Statistics
<div class="cols">
Measures of:

1. Frequency (counting)
2. Central tendency (mean, median, mode)
3. Dispersion (range, variance)
4. Position (percentiles)
5. Shape (skew and kurtosis)
</div>
<div class="cols">
![](../images/descriptive-statistics.png)
</div>
Open `scripts/04-statistics.R`

## Central Tendency
```{r, echo=TRUE, results='hide'}
turbidity <- filter(labdata, Measure == "Turbidity")

mean(turbidity$Result)
sum(turbidity$Result) / length(turbidity$Result)

median(turbidity$Result)
```

No standard function for calculating the mode.

## Measures of Dispersion
```{r, echo=TRUE, results='hide'}
min(turbidity$Result)
max(turbidity$Result)
range(turbidity$Result)
diff(range(turbidity$Result))
```

$$s=\sqrt{\frac{\sum_{i=1}^n (x_i-\bar{x})^2}{n-1}}$$

```{r, echo=TRUE, results='hide'}
var(turbidity$Result)
sd(turbidity$Result)

sqrt(sum((turbidity$Result - mean(turbidity$Result))^2) / 
       (length(turbidity$Result) - 1))
```

## Measure of Position (Quantiles and Percentiles)
<div class="cols"><small>

1. Place the observations in ascending order: $y_1, y_2, \ldots y_n$.
2. Calculate the rank ($r$) of the required percentile
3. Interpolate between adjacent numbers: $$y_r = y_{\lfloor r \rfloor}+ (y_{r_{\lceil r \rceil}} - y_{\lfloor r \rfloor})(r - \lfloor r \rfloor)$$
    - $y$: Observation
    - $r$: Ranking number
    - $\lfloor r \rfloor$: Floor or $r$
    - $\lceil r \rceil$: Ceiling of $r$
    
</small></div>
<div class="cols">
```{r, fig.asp=9/16}
x <- c(1, 2, 3.5, 4, 5)
y <- 2 * x

plot(x, y, pch = 19, 
     xlab = "Rank", 
     ylab = "Observation", 
     xaxt = "n",
     yaxt = "n", 
     frame.plot = FALSE)

axis(1, at = x,
     labels = c(1, 
                expression(group(lfloor, r, rfloor)), 
                "r", 
                expression(group(lceil, r, rceil)), 
                "n"))

axis(2, at = y,
     labels = c(expression(y[1]),
                expression(y[group(lfloor, r, rfloor)]),
                expression(y[r]),
                expression(y[group(lceil, r, rceil)]),
                expression(y[n])))

lines(x[1:2], y[1:2], lty = 2)
lines(x[2:4], y[2:4], lty = 1)
lines(x[4:5], y[4:5], lty = 2)

abline(h = y[3], col = "red", lwd = .5, lty = 2)
abline(v = x[3], col = "red", lwd = .5, lty = 2)

points(x, y)
```
</div>

## Measures of Position (continued)
```{r, echo=TRUE}
summary(turbidity$Result)
fivenum(turbidity$Result)
quantile(turbidity$Result, type = 6, probs = 0.95)
```

## Measures of Position (continued)

```{r, fig.asp=9/16}
sample <- c(1:17, 63, 170, 300)

## Set parameters
n <- length(sample)
p <- 0.95

## Visualise
par(mar=c(6, 5, 4, 1))
plot(sample, type = "b",
     xlab = "Rank", ylab = "Result",
     cex.axis = 1,
     cex.lab = 1,
     cex.main = 1,
     cex.sub = 1,
     lwd = 1)

## Calculate rank
r_weibull <- p * (n + 1)
r_excel <- 1 + p * (n - 1)

## Interpolate percentiles
x_weibull <- (1 - (r_weibull - floor(r_weibull))) * sample[floor(r_weibull)] + (r_weibull - floor(r_weibull)) * sample[ceiling(r_weibull)]
x_excel <- (1 - (r_excel - floor(r_excel))) * sample[floor(r_excel)] + (r_excel - floor(r_excel)) * sample[ceiling(r_excel)]

## Visualise
abline(v = r_weibull, col = "red", lwd = 1, lty = 3)
abline(v = r_excel, col = "blue", lwd = 1, lty = 2)

## Legend
legend("topleft", legend = c("Excel", "Weibull"), col = c("blue", "red"), lwd = 1, lty = c(2, 3))
```

## Grouped Analysis
![](../images/grouping.png)

## Grouped Analysis

```{r, echo=TRUE}
measures <- group_by(labdata, Measure, Suburb)
summarise(measures,
          Samples = n(),
          Mean = mean(Result),
          Median = median(Result),
          p95 = quantile(Result, type = 6, probs = 0.95))
```

## Coding Practice

1. Which suburb recorded the highest level of chlorine?
2. What is the average 95^th percentile of the turbidity for the towns in Gormsey, using the Weibull method?

Answers in `scripts/case-study-1.R`

# {data-background="../images/r4h2o-banner.jpg"}

# Program Session 2
1. Session 1 recapitulation
2. Principles of visualising data 
3. Visualising data with _ggplot2_
4. Data Science Workflow
5. RMarkdown
6. Learning R

## Session 1 recapitulation
![](../images/r4h2o-cheat-sheet.png){height=500}

## Coding Challenge
- Go to the Bureau of Meteorology website
    - [bom.gov.au/climate/data](http://www.bom.gov.au/climate/data/)
- Download daily rainfall data for your favourite weather station
- Determine the top five years with the highest total rainfall
- Tips: 
    - Variable names with spaces need to be between back ticks: \``variable name`\`
    - The data has missing values. Use the `na.rm = TRUE` option in the `sum()` function
    - Use the `slice_max()` function to list the top five years

## Solution
```{r, echo=TRUE}
library(tidyverse)
# Bridgewater weather station
bom <- read_csv("data/IDCJAC0009_081058_1800_Data.csv")
bom_grouped <- group_by(bom, Year)
bom_annual <- summarise(bom_grouped, 
                        Rainfall = sum(`Rainfall amount (millimetres)`, 
                                       na.rm = TRUE))
slice_max(bom_annual, order_by = Rainfall, n = 5)
```

# Visualising Data
```{r, fig.height=4}
data(anscombe)
library(tidyverse)

  p <- anscombe %>%
    select(1:4) %>%
    pivot_longer(cols = 1:4, names_to = "set", values_to = "x") %>%
    mutate(set = str_remove(set, "x"))

  q <- anscombe %>%
    select(5:8) %>%
    pivot_longer(cols = 1:4, names_to = "set", values_to = "y") %>%
    mutate(set = str_remove(set, "y"))

  tibble(p, y = q$y) %>%
    mutate(set = paste("Set", set))  %>%
    ggplot(aes(x, y)) +
    geom_smooth(method = "lm", se = FALSE, col = "gray") +
    geom_point(size = 2.5, colour = "black", fill = "gray", shape = 21) +
    facet_wrap(~set) + 
    theme_bw(base_size = 12) +
    labs(x = NULL, y = NULL, title = "Anscombe's Quartet")
```

## Datasaurus Dozen
```{r}
  library(datasauRus)

  ggplot(datasaurus_dozen, aes(x = x, y = y)) +
      geom_point(size = 1) +
      theme_void(base_size = 20) +
      theme(legend.position = "none") +
      facet_wrap(~dataset, ncol = 4)
```

## Basic Plotting
- Best for exploratory visualisations
- Plotting functions
    - `plot()`
    - `barplot()`
    - `histogram()`
    - `boxplot()` 

- Annotation functions (add elements to the plot)
    - `abline()`
    - `points()`

## Base plotting parameters
- `pch`: the plotting symbol (default is open circle)
- `lty`: the line type (default is solid line), can be dashed, dotted, etc..
- `lwd`: the line width, specified as an integer multiple
- `col`: the plotting colour, specified as a number, string, or hex code
- `xlab`: character string for the x-axis label
- `ylab`: character string for the y-axis label

## Plotting Example

`scripts/04-statistics.R` end of script

```{r, fig.height=3, fig.width=6}
library(tidyverse)
labdata <- read_csv("data/water_quality.csv")
turbidity <- filter(labdata, Measure == "Turbidity")

par(mfrow = c(1, 3))
plot(turbidity$Date, turbidity$Result, 
     type = "l", xlab = "Date", ylab = "Result",
     main = "Turbidity measurements")
abline(h = 5, col = "red")

boxplot(log10(Result) ~ Suburb, data = turbidity,
        pch = 19, las = 3, col = "brown",
        main = "Turbidity measurements", xlab = NULL)
abline(h = log10(5), col = "red")

p95 <- summarise(group_by(turbidity, Suburb), 
                 p95 = quantile(Result, 0.95))

barplot(p95$p95, names.arg = p95$Suburb,
        main = "95th percentile turbidity", las = 3)
abline(h = 5, col = "red")
```

# Data Story-Telling
![](../images/lego-visualisation.jpg)

## r/dataisugly
![](../images/data-is-ugly.jpg){height=600}

## r/dataisbeautiful
![](https://lucidmanager.org/images/data-science/nsidc_global_area_byyear_b.jpg){height=600}

## Solution
[lucidmanager.org/data-science/storytelling-with-data/](https://lucidmanager.org/data-science/storytelling-with-data/)
![](https://lucidmanager.org/images/data-science/ice-data-beautiful.png){height=500}

## Jackson Pollock
![](../images/bluepoles.jpg)

<small> Jackson Pollock (1952) Blue Poles number 11. Drip Painting in enamel and aluminium paint with glass on canvas (National Gallery, Canberra).</small>

## Piet Mondrian
![](../images/mondrian.jpg)
<small>Piet Mondrian (1928) Composition with red, yellow and blue. Oil on canvas (Municipal Museum, the Hague).</small>

## Data-Pixel Ratio
![](../images/data-pixel-ratio.png)

## {data-background="../images/visualisations.jpg"}

# ggplot2 package
![](../images/ggplot2.png){height=500}

`scripts/05-visualise.R`

## Grammar of Graphics
<div class="column" style="float:left; width: 50%">
1. _Data_: base material
2. _Aesthetics_: graph variables to be visualised
3. _Geometries_: shapes that represent the data
4. _Facets_: divide a visualisation into sub-plots.
5. _Statistics_: data summaries, such as trend lines.
6. _Coordinates_: how data is represented on the canvas
7. _Themes_: non-data pixels
</div>
<div class="column" style="float:left; width: 50%">
![](../images/grammar-of-graphics.png)
</div>

## Examples 1
```{r, echo = TRUE, eval=FALSE}
ggplot(labdata, aes(Town))

ggplot(labdata, aes(Measure)) + 
    geom_bar()

turbidity <- filter(labdata, Measure == "Turbidity")

ggplot(turbidity, aes(Date, Result, col = Town)) + 
    geom_line()
```

## Color Palettes
![](../images/colorbrewer.png){height=400}

## ColorBrewer
```{r, echo = TRUE, eval=FALSE}
ggplot(labdata, aes(Town, fill = Measure)) +
    geom_bar() +
    scale_fill_brewer(type = "qual",
                      palette = "Dark2")

library(RColorBrewer)
display.brewer.all() 

ggplot(labdata, aes(Town, fill = Measure)) +
    geom_bar() +
    scale_fill_manual(values = c("cornflowerblue",
                                 "darkseagreen",
                                 "#ee6611",
                                 "#ccaa44"))
```

## Facets
```{r, echo = TRUE, eval=FALSE}
ggplot(turbidity, aes(Date, Result, col = Town)) + 
    geom_line() + 
    facet_wrap(~Town)
```

## Statistics
```{r, echo = TRUE, eval=FALSE}
thm <- filter(labdata, Measure == "THM")
thm_grouped <- group_by(thm, Date)
thm_max <- summarise(thm_grouped, thm_max = max(Result))

ggplot(thm_max, aes(Date, thm_max)) + 
    geom_smooth(method = "lm") + 
    geom_line() + 
    geom_hline(yintercept = 0.25, col = "red")
```

## Coordinates
```{r, echo = TRUE, eval=FALSE}
ggplot(turbidity, aes(Town, Result)) + 
    geom_boxplot() + 
    scale_y_log10(name = "Samples (log)",
                  n.breaks = 10) +
    coord_flip()
```

- `scale_x_log10()`: Logarithmic scale.
- `scale_x_discrete()`: Discrete variables (names).
- `scale_x_continuous()`: Continuous variables, such as measurements.
- `scale_x_date()`: For displaying dates and times.


## Themes
```{r, fig.height=2.5, fig.width=5}
  library(gridExtra)

  p <- ggplot(labdata, aes(Measure)) + geom_bar()
  a <- p + theme_classic(base_size = 8) + ggtitle("theme_clasic()")
  b <- a + theme_bw(base_size = 8) + ggtitle("theme_bw()")
  c <- a + theme_minimal(base_size = 8) + ggtitle("theme_minimal()")
  d <- a + theme_void(base_size = 8) + ggtitle("theme_void()")
  grid.arrange(a, b, c, d)
```

## Combining data sets
```{r, echo=TRUE, results='hide'}
chlorine <- filter(labdata, Measure == "Chlorine Total")

chlorine_gr <- group_by(chlorine, Suburb)
  
chlorine_avg <- summarise(chlorine_gr, avg = mean(Result))

ggplot(chlorine, aes(Date, Result)) + 
  geom_line() + 
  facet_wrap(~Suburb) + 
  geom_hline(data = chlorine_avg, aes(yintercept = avg), col = "blue", lty = 2) + 
  theme_minimal() + 
  labs(title = "Average total chlorine leves in labdata",
       x = NULL, y = "Total Chlorine")
```

## ggplot2 Cheat Sheet
![](../images/ggplot2-cheat-sheet.png){height=600}

# 
![](../images/coffee.jpg)

# Data Science Workflow
![](../images/workflow.png)


## Replicable and Reproducible
[coderefinery.github.io/reproducible-research](https://coderefinery.github.io/reproducible-research)
<div class="column" style="float:left; width: 50%">
![](../images/replicable.png){height=300}
</div>
<div class="column" style="float:left; width: 50%">
![](../images/reproducible.png){height=300}
</div>

## Define
> The regulator for water quality has released a new guideline that lowers the maximum value for trihalomethanes (THMs) at the customer tap to 0.20 mg/l. This report assesses the historical performance of the Gormsey water system to evaluate the risk of non-compliance, assuming no operational changes are implemented.

## Load and Tidy
```{r, echo=TRUE}
library(readr)
library(dplyr)
labdata <- read_csv("data/water_quality.csv")
thm <- filter(labdata, Measure == "THM")
glimpse(thm)
```

## Explore
```{r}
  library(tidyverse)
  library(datasauRus)

  filter(datasaurus_dozen,
         dataset %in% c("dino", "x_shape", "star", "bullseye")) %>%
      ggplot(aes(x = x, y = y)) +
      geom_point() +
      theme_void(base_size = 20) +
      theme(legend.position = "none") +
      facet_wrap(~dataset, ncol = 6)
```

## Explore THM
```{r, echo = TRUE, fig.height=2.5}
filter(labdata, Measure == "THM") %>% 
  ggplot(aes(Suburb, Result)) + 
  geom_boxplot() + 
  geom_hline(yintercept = .2, col = "red", linetype = "longdash") + 
  scale_y_log10() + 
  coord_flip() + 
  theme_minimal() + 
  labs(title = "THM Results",
       subtitle = "Gormsey") 
```

## Model
>  “All models of reality are wrong, but some are useful.”

```{r, echo=TRUE}
filter(thm, Result > 0.2)
```

## Reflect
> Further investigation required to determine the cause


## Communicate (RMarkdown)
![](../images/rmarkdown.png)

## Tables
```{r, echo=TRUE}
library(knitr)
thm_fail <- filter(labdata, Measure == "THM" & Result > .25)
kable(select(thm_fail, Date, Suburb, Result),
      caption = "Example outut of the `kable()` function.", 
      digits = 2)
```

## Rounding Numbers
```{r, echo=TRUE}
a <- sqrt(777)
round(a)
round(a, 2)
round(a, -1)
floor(a)
ceiling(a)
signif(a, 5)
```

# Learning Data Science

1. Understand the basics
2. Code by hand
3. Create simple programs
4. Practice
5. Ask for help
6. Build projects
7. Help others