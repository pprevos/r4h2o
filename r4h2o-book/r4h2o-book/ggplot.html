<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Visualising Data with ggplot2 | Data Science for Water Professionals - Create Value from Data with the R Language</title>
  <meta name="description" content="Data science course for water management professionals using the R language. This course is developed for water professionals with little to no experience writing code to analyse data." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Visualising Data with ggplot2 | Data Science for Water Professionals - Create Value from Data with the R Language" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://lucidmanager.org/r4h2o" />
  <meta property="og:image" content="https://lucidmanager.org/r4h2o/images/r4h2o-cover.jpg" />
  <meta property="og:description" content="Data science course for water management professionals using the R language. This course is developed for water professionals with little to no experience writing code to analyse data." />
  <meta name="github-repo" content="pprevos/r4h2o" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Visualising Data with ggplot2 | Data Science for Water Professionals - Create Value from Data with the R Language" />
  
  <meta name="twitter:description" content="Data science course for water management professionals using the R language. This course is developed for water professionals with little to no experience writing code to analyse data." />
  <meta name="twitter:image" content="https://lucidmanager.org/r4h2o/images/r4h2o-cover.jpg" />

<meta name="author" content="Dr Peter Prevos" />


<meta name="date" content="2021-12-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="statistics.html"/>
<link rel="next" href="dataproducts.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Science for Water Professionals</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#continuous-improvement"><i class="fa fa-check"></i>Continuous Improvement</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#learning-objectives"><i class="fa fa-check"></i><b>1.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#prerequisites"><i class="fa fa-check"></i><b>1.2</b> Prerequisites</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#case-study-approach"><i class="fa fa-check"></i><b>1.3</b> Case Study approach</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="introduction.html"><a href="introduction.html#case-study-1-water-quality-regulations"><i class="fa fa-check"></i><b>1.3.1</b> Case Study 1: Water Quality Regulations</a></li>
<li class="chapter" data-level="1.3.2" data-path="introduction.html"><a href="introduction.html#case-study-2-customer-experience"><i class="fa fa-check"></i><b>1.3.2</b> Case Study 2: Customer Experience</a></li>
<li class="chapter" data-level="1.3.3" data-path="introduction.html"><a href="introduction.html#case-study-3-digital-metering-data"><i class="fa fa-check"></i><b>1.3.3</b> Case Study 3: Digital Metering Data</a></li>
<li class="chapter" data-level="1.3.4" data-path="introduction.html"><a href="introduction.html#case-study-4-spatial-analysis"><i class="fa fa-check"></i><b>1.3.4</b> Case Study 4: Spatial Analysis</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#learning-the-r-language"><i class="fa fa-check"></i><b>1.4</b> Learning the R Language</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="datascience.html"><a href="datascience.html"><i class="fa fa-check"></i><b>2</b> Principles of Water Utility Data Science</a>
<ul>
<li class="chapter" data-level="2.1" data-path="datascience.html"><a href="datascience.html#what-is-data-science"><i class="fa fa-check"></i><b>2.1</b> What is data science?</a></li>
<li class="chapter" data-level="2.2" data-path="datascience.html"><a href="datascience.html#the-elements-of-data-science"><i class="fa fa-check"></i><b>2.2</b> The Elements of Data Science</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="datascience.html"><a href="datascience.html#domain-knowledge"><i class="fa fa-check"></i><b>2.2.1</b> Domain Knowledge</a></li>
<li class="chapter" data-level="2.2.2" data-path="datascience.html"><a href="datascience.html#mathematical-knowledge"><i class="fa fa-check"></i><b>2.2.2</b> Mathematical Knowledge</a></li>
<li class="chapter" data-level="2.2.3" data-path="datascience.html"><a href="datascience.html#computer-science"><i class="fa fa-check"></i><b>2.2.3</b> Computer Science</a></li>
<li class="chapter" data-level="2.2.4" data-path="datascience.html"><a href="datascience.html#the-unicorn-data-scientist"><i class="fa fa-check"></i><b>2.2.4</b> The Unicorn Data Scientist?</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="datascience.html"><a href="datascience.html#the-water-data-value-chain"><i class="fa fa-check"></i><b>2.3</b> The Water-Data Value Chain</a></li>
<li class="chapter" data-level="2.4" data-path="datascience.html"><a href="datascience.html#data-science-tools"><i class="fa fa-check"></i><b>2.4</b> Data Science Tools</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="datascience.html"><a href="datascience.html#spreadsheets"><i class="fa fa-check"></i><b>2.4.1</b> Spreadsheets</a></li>
<li class="chapter" data-level="2.4.2" data-path="datascience.html"><a href="datascience.html#business-intelligence-systems"><i class="fa fa-check"></i><b>2.4.2</b> Business Intelligence Systems</a></li>
<li class="chapter" data-level="2.4.3" data-path="datascience.html"><a href="datascience.html#data-science-code"><i class="fa fa-check"></i><b>2.4.3</b> Data science code</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="datascience.html"><a href="datascience.html#good-data-science"><i class="fa fa-check"></i><b>2.5</b> Good Data Science</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="datascience.html"><a href="datascience.html#data-science-trivium"><i class="fa fa-check"></i><b>2.5.1</b> Data Science Trivium</a></li>
<li class="chapter" data-level="2.5.2" data-path="datascience.html"><a href="datascience.html#useful-data-science"><i class="fa fa-check"></i><b>2.5.2</b> Useful Data Science</a></li>
<li class="chapter" data-level="2.5.3" data-path="datascience.html"><a href="datascience.html#sound-data-science"><i class="fa fa-check"></i><b>2.5.3</b> Sound Data Science</a></li>
<li class="chapter" data-level="2.5.4" data-path="datascience.html"><a href="datascience.html#aesthetic-data-science"><i class="fa fa-check"></i><b>2.5.4</b> Aesthetic Data Science</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="datascience.html"><a href="datascience.html#further-study"><i class="fa fa-check"></i><b>2.6</b> Further Study</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="basics.html"><a href="basics.html"><i class="fa fa-check"></i><b>3</b> Introduction to the R Language</a>
<ul>
<li class="chapter" data-level="3.1" data-path="basics.html"><a href="basics.html#the-r-language"><i class="fa fa-check"></i><b>3.1</b> The R Language</a></li>
<li class="chapter" data-level="3.2" data-path="basics.html"><a href="basics.html#basic-principles-of-programming"><i class="fa fa-check"></i><b>3.2</b> Basic principles of programming</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="basics.html"><a href="basics.html#understanding-computer-code"><i class="fa fa-check"></i><b>3.2.1</b> Understanding computer code</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="basics.html"><a href="basics.html#debugging-code"><i class="fa fa-check"></i><b>3.3</b> Debugging Code</a></li>
<li class="chapter" data-level="3.4" data-path="basics.html"><a href="basics.html#using-r-and-rstudio"><i class="fa fa-check"></i><b>3.4</b> Using R and RStudio</a></li>
<li class="chapter" data-level="3.5" data-path="basics.html"><a href="basics.html#basics-of-the-r-language"><i class="fa fa-check"></i><b>3.5</b> Basics of the R language</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="basics.html"><a href="basics.html#variables"><i class="fa fa-check"></i><b>3.5.1</b> Variables</a></li>
<li class="chapter" data-level="3.5.2" data-path="basics.html"><a href="basics.html#arithmetic"><i class="fa fa-check"></i><b>3.5.2</b> Arithmetic</a></li>
<li class="chapter" data-level="3.5.3" data-path="basics.html"><a href="basics.html#vectors"><i class="fa fa-check"></i><b>3.5.3</b> Vectors</a></li>
<li class="chapter" data-level="3.5.4" data-path="basics.html"><a href="basics.html#basic-plots"><i class="fa fa-check"></i><b>3.5.4</b> Basic plots</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="basics.html"><a href="basics.html#rstudio-scripts-and-projects"><i class="fa fa-check"></i><b>3.6</b> RStudio scripts and projects</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="basics.html"><a href="basics.html#readable-code"><i class="fa fa-check"></i><b>3.6.1</b> Readable Code</a></li>
<li class="chapter" data-level="3.6.2" data-path="basics.html"><a href="basics.html#finding-help"><i class="fa fa-check"></i><b>3.6.2</b> Finding help</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="basics.html"><a href="basics.html#quiz-1-calculating-channel-flows"><i class="fa fa-check"></i><b>3.7</b> Quiz 1: Calculating channel flows</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="basics.html"><a href="basics.html#question-1"><i class="fa fa-check"></i><b>3.7.1</b> Question 1</a></li>
<li class="chapter" data-level="3.7.2" data-path="basics.html"><a href="basics.html#question-2"><i class="fa fa-check"></i><b>3.7.2</b> Question 2</a></li>
<li class="chapter" data-level="3.7.3" data-path="basics.html"><a href="basics.html#question-3"><i class="fa fa-check"></i><b>3.7.3</b> Question 3</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="basics.html"><a href="basics.html#further-study-1"><i class="fa fa-check"></i><b>3.8</b> Further Study</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="tidyverse.html"><a href="tidyverse.html"><i class="fa fa-check"></i><b>4</b> Exploring Data with the Tidyverse</a>
<ul>
<li class="chapter" data-level="4.1" data-path="tidyverse.html"><a href="tidyverse.html#r-libraries"><i class="fa fa-check"></i><b>4.1</b> R Libraries</a></li>
<li class="chapter" data-level="4.2" data-path="tidyverse.html"><a href="tidyverse.html#introducing-the-tidyverse"><i class="fa fa-check"></i><b>4.2</b> Introducing the Tidyverse</a></li>
<li class="chapter" data-level="4.3" data-path="tidyverse.html"><a href="tidyverse.html#case-study-1"><i class="fa fa-check"></i><b>4.3</b> Case Study 1</a></li>
<li class="chapter" data-level="4.4" data-path="tidyverse.html"><a href="tidyverse.html#exploring-the-case-study-data"><i class="fa fa-check"></i><b>4.4</b> Exploring the Case Study Data</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="tidyverse.html"><a href="tidyverse.html#inspect-the-data"><i class="fa fa-check"></i><b>4.4.1</b> Inspect the data</a></li>
<li class="chapter" data-level="4.4.2" data-path="tidyverse.html"><a href="tidyverse.html#explore-the-content"><i class="fa fa-check"></i><b>4.4.2</b> Explore the content</a></li>
<li class="chapter" data-level="4.4.3" data-path="tidyverse.html"><a href="tidyverse.html#explore-variables"><i class="fa fa-check"></i><b>4.4.3</b> Explore variables</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="tidyverse.html"><a href="tidyverse.html#filtering-data"><i class="fa fa-check"></i><b>4.5</b> Filtering data</a></li>
<li class="chapter" data-level="4.6" data-path="tidyverse.html"><a href="tidyverse.html#counting-results"><i class="fa fa-check"></i><b>4.6</b> Counting results</a></li>
<li class="chapter" data-level="4.7" data-path="tidyverse.html"><a href="tidyverse.html#quiz-2-exploring-water-quality-data"><i class="fa fa-check"></i><b>4.7</b> Quiz 2: Exploring Water Quality Data</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="tidyverse.html"><a href="tidyverse.html#question-1-1"><i class="fa fa-check"></i><b>4.7.1</b> Question 1</a></li>
<li class="chapter" data-level="4.7.2" data-path="tidyverse.html"><a href="tidyverse.html#question-2-1"><i class="fa fa-check"></i><b>4.7.2</b> Question 2</a></li>
<li class="chapter" data-level="4.7.3" data-path="tidyverse.html"><a href="tidyverse.html#question-3-1"><i class="fa fa-check"></i><b>4.7.3</b> Question 3</a></li>
<li class="chapter" data-level="4.7.4" data-path="tidyverse.html"><a href="tidyverse.html#question-4"><i class="fa fa-check"></i><b>4.7.4</b> Question 4</a></li>
<li class="chapter" data-level="4.7.5" data-path="tidyverse.html"><a href="tidyverse.html#question-5"><i class="fa fa-check"></i><b>4.7.5</b> Question 5</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="tidyverse.html"><a href="tidyverse.html#further-study-2"><i class="fa fa-check"></i><b>4.8</b> Further Study</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="tidyverse.html"><a href="tidyverse.html#packages"><i class="fa fa-check"></i><b>4.8.1</b> Packages</a></li>
<li class="chapter" data-level="4.8.2" data-path="tidyverse.html"><a href="tidyverse.html#loading-data"><i class="fa fa-check"></i><b>4.8.2</b> Loading data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="statistics.html"><a href="statistics.html"><i class="fa fa-check"></i><b>5</b> Descriptive Statistics</a>
<ul>
<li class="chapter" data-level="5.1" data-path="statistics.html"><a href="statistics.html#problem-statement"><i class="fa fa-check"></i><b>5.1</b> Problem Statement</a></li>
<li class="chapter" data-level="5.2" data-path="statistics.html"><a href="statistics.html#analyse-the-data"><i class="fa fa-check"></i><b>5.2</b> Analyse the Data</a></li>
<li class="chapter" data-level="5.3" data-path="statistics.html"><a href="statistics.html#calculating-percentiles"><i class="fa fa-check"></i><b>5.3</b> Calculating Percentiles</a></li>
<li class="chapter" data-level="5.4" data-path="statistics.html"><a href="statistics.html#analysing-grouped-data"><i class="fa fa-check"></i><b>5.4</b> Analysing Grouped Data</a></li>
<li class="chapter" data-level="5.5" data-path="statistics.html"><a href="statistics.html#quiz-3-analysing-water-quality-data"><i class="fa fa-check"></i><b>5.5</b> Quiz 3: Analysing Water Quality Data</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="statistics.html"><a href="statistics.html#question-1-2"><i class="fa fa-check"></i><b>5.5.1</b> Question 1</a></li>
<li class="chapter" data-level="5.5.2" data-path="statistics.html"><a href="statistics.html#question-2-2"><i class="fa fa-check"></i><b>5.5.2</b> Question 2</a></li>
<li class="chapter" data-level="5.5.3" data-path="statistics.html"><a href="statistics.html#question-3-2"><i class="fa fa-check"></i><b>5.5.3</b> Question 3</a></li>
<li class="chapter" data-level="5.5.4" data-path="statistics.html"><a href="statistics.html#question-4-1"><i class="fa fa-check"></i><b>5.5.4</b> Question 4</a></li>
<li class="chapter" data-level="5.5.5" data-path="statistics.html"><a href="statistics.html#question-5-1"><i class="fa fa-check"></i><b>5.5.5</b> Question 5</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="statistics.html"><a href="statistics.html#further-study-3"><i class="fa fa-check"></i><b>5.6</b> Further Study</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="ggplot.html"><a href="ggplot.html"><i class="fa fa-check"></i><b>6</b> Visualising Data with ggplot2</a>
<ul>
<li class="chapter" data-level="6.1" data-path="ggplot.html"><a href="ggplot.html#principles-of-visualisation"><i class="fa fa-check"></i><b>6.1</b> Principles of Visualisation</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="ggplot.html"><a href="ggplot.html#the-aesthetics-of-visualising-data"><i class="fa fa-check"></i><b>6.1.1</b> The aesthetics of visualising data</a></li>
<li class="chapter" data-level="6.1.2" data-path="ggplot.html"><a href="ggplot.html#telling-stories"><i class="fa fa-check"></i><b>6.1.2</b> Telling Stories</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="ggplot.html"><a href="ggplot.html#visualising-data-with-ggplot"><i class="fa fa-check"></i><b>6.2</b> Visualising data with ggplot</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="ggplot.html"><a href="ggplot.html#data-1"><i class="fa fa-check"></i><b>6.2.1</b> Data</a></li>
<li class="chapter" data-level="6.2.2" data-path="ggplot.html"><a href="ggplot.html#aesthetics"><i class="fa fa-check"></i><b>6.2.2</b> Aesthetics</a></li>
<li class="chapter" data-level="6.2.3" data-path="ggplot.html"><a href="ggplot.html#geometries"><i class="fa fa-check"></i><b>6.2.3</b> Geometries</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="ggplot.html"><a href="ggplot.html#colour-aesthetics"><i class="fa fa-check"></i><b>6.3</b> Colour Aesthetics</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="ggplot.html"><a href="ggplot.html#facets"><i class="fa fa-check"></i><b>6.3.1</b> Facets</a></li>
<li class="chapter" data-level="6.3.2" data-path="ggplot.html"><a href="ggplot.html#statistics-1"><i class="fa fa-check"></i><b>6.3.2</b> Statistics</a></li>
<li class="chapter" data-level="6.3.3" data-path="ggplot.html"><a href="ggplot.html#coordinates"><i class="fa fa-check"></i><b>6.3.3</b> Coordinates</a></li>
<li class="chapter" data-level="6.3.4" data-path="ggplot.html"><a href="ggplot.html#theme"><i class="fa fa-check"></i><b>6.3.4</b> Theme</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="ggplot.html"><a href="ggplot.html#sharing-visualisations"><i class="fa fa-check"></i><b>6.4</b> Sharing visualisations</a></li>
<li class="chapter" data-level="6.5" data-path="ggplot.html"><a href="ggplot.html#further-study-4"><i class="fa fa-check"></i><b>6.5</b> Further Study</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="dataproducts.html"><a href="dataproducts.html"><i class="fa fa-check"></i><b>7</b> Creating Data Products</a>
<ul>
<li class="chapter" data-level="7.1" data-path="dataproducts.html"><a href="dataproducts.html#data-science-workflow"><i class="fa fa-check"></i><b>7.1</b> Data Science Workflow</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="dataproducts.html"><a href="dataproducts.html#define"><i class="fa fa-check"></i><b>7.1.1</b> Define</a></li>
<li class="chapter" data-level="7.1.2" data-path="dataproducts.html"><a href="dataproducts.html#prepare"><i class="fa fa-check"></i><b>7.1.2</b> Prepare</a></li>
<li class="chapter" data-level="7.1.3" data-path="dataproducts.html"><a href="dataproducts.html#understand"><i class="fa fa-check"></i><b>7.1.3</b> Understand</a></li>
<li class="chapter" data-level="7.1.4" data-path="dataproducts.html"><a href="dataproducts.html#communicate"><i class="fa fa-check"></i><b>7.1.4</b> Communicate</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="dataproducts.html"><a href="dataproducts.html#reproducible-research"><i class="fa fa-check"></i><b>7.2</b> Reproducible Research</a></li>
<li class="chapter" data-level="7.3" data-path="dataproducts.html"><a href="dataproducts.html#r-markdown"><i class="fa fa-check"></i><b>7.3</b> R-Markdown</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="dataproducts.html"><a href="dataproducts.html#formatting-tables"><i class="fa fa-check"></i><b>7.3.1</b> Formatting tables</a></li>
<li class="chapter" data-level="7.3.2" data-path="dataproducts.html"><a href="dataproducts.html#presenting-numbers"><i class="fa fa-check"></i><b>7.3.2</b> Presenting numbers</a></li>
<li class="chapter" data-level="7.3.3" data-path="dataproducts.html"><a href="dataproducts.html#export-formats"><i class="fa fa-check"></i><b>7.3.3</b> Export formats</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="dataproducts.html"><a href="dataproducts.html#further-study-5"><i class="fa fa-check"></i><b>7.4</b> Further Study</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="tidyverse.html"><a href="tidyverse.html#cleaning"><i class="fa fa-check"></i><b>8</b> Cleaning Data</a>
<ul>
<li class="chapter" data-level="8.1" data-path="cleaning.html"><a href="cleaning.html"><i class="fa fa-check"></i><b>8.1</b> Case Study 2</a></li>
<li class="chapter" data-level="8.2" data-path="cleaning.html"><a href="cleaning.html#cleaning-data"><i class="fa fa-check"></i><b>8.2</b> Cleaning data</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="cleaning.html"><a href="cleaning.html#load-and-explore-the-data"><i class="fa fa-check"></i><b>8.2.1</b> Load and explore the data</a></li>
<li class="chapter" data-level="8.2.2" data-path="cleaning.html"><a href="cleaning.html#remove-unwanted-responses"><i class="fa fa-check"></i><b>8.2.2</b> Remove unwanted responses</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="cleaning.html"><a href="cleaning.html#joining-data-frames"><i class="fa fa-check"></i><b>8.3</b> Joining data frames</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="cleaning.html"><a href="cleaning.html#select-relevant-variables"><i class="fa fa-check"></i><b>8.3.1</b> Select relevant variables</a></li>
<li class="chapter" data-level="8.3.2" data-path="cleaning.html"><a href="cleaning.html#writedata"><i class="fa fa-check"></i><b>8.3.2</b> Write data to disk</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="cleaning.html"><a href="cleaning.html#simplifying-code-with-data-pipes"><i class="fa fa-check"></i><b>8.4</b> Simplifying Code with Data Pipes</a></li>
<li class="chapter" data-level="8.5" data-path="cleaning.html"><a href="cleaning.html#quiz-4-cleaning-data"><i class="fa fa-check"></i><b>8.5</b> Quiz 4: Cleaning Data</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="cleaning.html"><a href="cleaning.html#question-1-3"><i class="fa fa-check"></i><b>8.5.1</b> Question 1</a></li>
<li class="chapter" data-level="8.5.2" data-path="cleaning.html"><a href="cleaning.html#question-2-3"><i class="fa fa-check"></i><b>8.5.2</b> Question 2</a></li>
<li class="chapter" data-level="8.5.3" data-path="cleaning.html"><a href="cleaning.html#question-3-3"><i class="fa fa-check"></i><b>8.5.3</b> Question 3</a></li>
<li class="chapter" data-level="8.5.4" data-path="cleaning.html"><a href="cleaning.html#question-4-2"><i class="fa fa-check"></i><b>8.5.4</b> Question 4</a></li>
<li class="chapter" data-level="8.5.5" data-path="cleaning.html"><a href="cleaning.html#question-5-2"><i class="fa fa-check"></i><b>8.5.5</b> Question 5</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="cleaning.html"><a href="cleaning.html#further-study-6"><i class="fa fa-check"></i><b>8.6</b> Further Study</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="customers.html"><a href="customers.html"><i class="fa fa-check"></i><b>9</b> Exploring the Customer Experience</a>
<ul>
<li class="chapter" data-level="9.1" data-path="customers.html"><a href="customers.html#measuring-mental-states"><i class="fa fa-check"></i><b>9.1</b> Measuring Mental States</a></li>
<li class="chapter" data-level="9.2" data-path="customers.html"><a href="customers.html#consumer-involvement"><i class="fa fa-check"></i><b>9.2</b> Consumer Involvement</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="customers.html"><a href="customers.html#personal-involvement-inventory"><i class="fa fa-check"></i><b>9.2.1</b> Personal Involvement Inventory</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="customers.html"><a href="customers.html#preparing-the-involvement-data"><i class="fa fa-check"></i><b>9.3</b> Preparing the Involvement Data</a></li>
<li class="chapter" data-level="9.4" data-path="customers.html"><a href="customers.html#missing-data"><i class="fa fa-check"></i><b>9.4</b> Missing Data</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="customers.html"><a href="customers.html#imputation"><i class="fa fa-check"></i><b>9.4.1</b> Imputation</a></li>
<li class="chapter" data-level="9.4.2" data-path="customers.html"><a href="customers.html#calculations-with-missing-data"><i class="fa fa-check"></i><b>9.4.2</b> Calculations with missing data</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="customers.html"><a href="customers.html#tidy-data"><i class="fa fa-check"></i><b>9.5</b> Tidy Data</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="customers.html"><a href="customers.html#explore-the-results"><i class="fa fa-check"></i><b>9.5.1</b> Explore the results</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="customers.html"><a href="customers.html#quiz-5-transforming-data"><i class="fa fa-check"></i><b>9.6</b> Quiz 5: Transforming data</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="customers.html"><a href="customers.html#question-1-4"><i class="fa fa-check"></i><b>9.6.1</b> Question 1</a></li>
<li class="chapter" data-level="9.6.2" data-path="customers.html"><a href="customers.html#question-2-4"><i class="fa fa-check"></i><b>9.6.2</b> Question 2</a></li>
<li class="chapter" data-level="9.6.3" data-path="customers.html"><a href="customers.html#question-3-4"><i class="fa fa-check"></i><b>9.6.3</b> Question 3</a></li>
<li class="chapter" data-level="9.6.4" data-path="customers.html"><a href="customers.html#question-4-3"><i class="fa fa-check"></i><b>9.6.4</b> Question 4</a></li>
<li class="chapter" data-level="9.6.5" data-path="customers.html"><a href="customers.html#question-5-3"><i class="fa fa-check"></i><b>9.6.5</b> Question 5</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="customers.html"><a href="customers.html#further-study-7"><i class="fa fa-check"></i><b>9.7</b> Further Study</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="customers.html"><a href="customers.html#the-dplyr-package"><i class="fa fa-check"></i><b>9.7.1</b> The <em>dplyr</em> package</a></li>
<li class="chapter" data-level="9.7.2" data-path="customers.html"><a href="customers.html#customer-surveys"><i class="fa fa-check"></i><b>9.7.2</b> Customer Surveys</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="survey.html"><a href="survey.html"><i class="fa fa-check"></i><b>10</b> Analysing the customer experience</a>
<ul>
<li class="chapter" data-level="10.1" data-path="survey.html"><a href="survey.html#the-reliability-and-validity-of-survey-results"><i class="fa fa-check"></i><b>10.1</b> The Reliability and Validity of Survey Results</a></li>
<li class="chapter" data-level="10.2" data-path="survey.html"><a href="survey.html#correlations"><i class="fa fa-check"></i><b>10.2</b> Correlations</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="survey.html"><a href="survey.html#visualising-correlation"><i class="fa fa-check"></i><b>10.2.1</b> Visualising correlation</a></li>
<li class="chapter" data-level="10.2.2" data-path="survey.html"><a href="survey.html#statisical-significance"><i class="fa fa-check"></i><b>10.2.2</b> Statisical significance</a></li>
<li class="chapter" data-level="10.2.3" data-path="survey.html"><a href="survey.html#limitations-of-correlations"><i class="fa fa-check"></i><b>10.2.3</b> Limitations of correlations</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="survey.html"><a href="survey.html#cronbachs-alpha"><i class="fa fa-check"></i><b>10.3</b> Cronbach’s Alpha</a></li>
<li class="chapter" data-level="10.4" data-path="survey.html"><a href="survey.html#hierarchical-clustering-to-assess-validity"><i class="fa fa-check"></i><b>10.4</b> Hierarchical Clustering to assess validity</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="survey.html"><a href="survey.html#clustering-analysis-example"><i class="fa fa-check"></i><b>10.4.1</b> Clustering Analysis Example</a></li>
<li class="chapter" data-level="10.4.2" data-path="survey.html"><a href="survey.html#pre-processing"><i class="fa fa-check"></i><b>10.4.2</b> Pre-processing</a></li>
<li class="chapter" data-level="10.4.3" data-path="survey.html"><a href="survey.html#scaling"><i class="fa fa-check"></i><b>10.4.3</b> Scaling</a></li>
<li class="chapter" data-level="10.4.4" data-path="survey.html"><a href="survey.html#distances"><i class="fa fa-check"></i><b>10.4.4</b> Distances</a></li>
<li class="chapter" data-level="10.4.5" data-path="survey.html"><a href="survey.html#clustering"><i class="fa fa-check"></i><b>10.4.5</b> Clustering</a></li>
<li class="chapter" data-level="10.4.6" data-path="survey.html"><a href="survey.html#interpreting-cluster-analyses"><i class="fa fa-check"></i><b>10.4.6</b> Interpreting Cluster Analyses</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="survey.html"><a href="survey.html#clustering-the-involvement-data"><i class="fa fa-check"></i><b>10.5</b> Clustering the Involvement Data</a></li>
<li class="chapter" data-level="10.6" data-path="survey.html"><a href="survey.html#reviewing-the-personal-involvement-index"><i class="fa fa-check"></i><b>10.6</b> Reviewing the Personal Involvement Index</a></li>
<li class="chapter" data-level="10.7" data-path="survey.html"><a href="survey.html#quiz"><i class="fa fa-check"></i><b>10.7</b> Quiz</a>
<ul>
<li class="chapter" data-level="10.7.1" data-path="survey.html"><a href="survey.html#question-1-5"><i class="fa fa-check"></i><b>10.7.1</b> Question 1</a></li>
<li class="chapter" data-level="10.7.2" data-path="survey.html"><a href="survey.html#question-2-5"><i class="fa fa-check"></i><b>10.7.2</b> Question 2</a></li>
<li class="chapter" data-level="10.7.3" data-path="survey.html"><a href="survey.html#question-3-5"><i class="fa fa-check"></i><b>10.7.3</b> Question 3</a></li>
<li class="chapter" data-level="10.7.4" data-path="survey.html"><a href="survey.html#question-4-4"><i class="fa fa-check"></i><b>10.7.4</b> Question 4</a></li>
</ul></li>
<li class="chapter" data-level="10.8" data-path="survey.html"><a href="survey.html#further-study-8"><i class="fa fa-check"></i><b>10.8</b> Further study</a>
<ul>
<li class="chapter" data-level="10.8.1" data-path="survey.html"><a href="survey.html#other-techniques"><i class="fa fa-check"></i><b>10.8.1</b> Other techniques</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="close.html"><a href="close.html"><i class="fa fa-check"></i><b>11</b> In Closing</a>
<ul>
<li class="chapter" data-level="11.1" data-path="close.html"><a href="close.html#searching-for-answers"><i class="fa fa-check"></i><b>11.1</b> Searching for answers</a></li>
<li class="chapter" data-level="11.2" data-path="close.html"><a href="close.html#forums"><i class="fa fa-check"></i><b>11.2</b> Forums</a></li>
<li class="chapter" data-level="11.3" data-path="close.html"><a href="close.html#further-study-9"><i class="fa fa-check"></i><b>11.3</b> Further Study</a></li>
<li class="chapter" data-level="11.4" data-path="close.html"><a href="close.html#thanks"><i class="fa fa-check"></i><b>11.4</b> Thanks</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i><b>12</b> Appendix</a>
<ul>
<li class="chapter" data-level="12.1" data-path="appendix.html"><a href="appendix.html#answers-to-quiz-1"><i class="fa fa-check"></i><b>12.1</b> Answers to Quiz 1</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="appendix.html"><a href="appendix.html#question-1-6"><i class="fa fa-check"></i><b>12.1.1</b> Question 1</a></li>
<li class="chapter" data-level="12.1.2" data-path="appendix.html"><a href="appendix.html#question-2-6"><i class="fa fa-check"></i><b>12.1.2</b> Question 2</a></li>
<li class="chapter" data-level="12.1.3" data-path="appendix.html"><a href="appendix.html#question-3-6"><i class="fa fa-check"></i><b>12.1.3</b> Question 3</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="appendix.html"><a href="appendix.html#answers-to-quiz-2"><i class="fa fa-check"></i><b>12.2</b> Answers to Quiz 2</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="appendix.html"><a href="appendix.html#question-1-7"><i class="fa fa-check"></i><b>12.2.1</b> Question 1</a></li>
<li class="chapter" data-level="12.2.2" data-path="appendix.html"><a href="appendix.html#question-2-7"><i class="fa fa-check"></i><b>12.2.2</b> Question 2</a></li>
<li class="chapter" data-level="12.2.3" data-path="appendix.html"><a href="appendix.html#question-3-7"><i class="fa fa-check"></i><b>12.2.3</b> Question 3</a></li>
<li class="chapter" data-level="12.2.4" data-path="appendix.html"><a href="appendix.html#question-4-5"><i class="fa fa-check"></i><b>12.2.4</b> Question 4</a></li>
<li class="chapter" data-level="12.2.5" data-path="appendix.html"><a href="appendix.html#question-5-4"><i class="fa fa-check"></i><b>12.2.5</b> Question 5</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="appendix.html"><a href="appendix.html#answers-to-quiz-3"><i class="fa fa-check"></i><b>12.3</b> Answers to Quiz 3</a></li>
<li class="chapter" data-level="12.4" data-path="appendix.html"><a href="appendix.html#answers-to-quiz-4"><i class="fa fa-check"></i><b>12.4</b> Answers to Quiz 4</a>
<ul>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html#question-1-8"><i class="fa fa-check"></i>Question 1</a></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html#question-2-8"><i class="fa fa-check"></i>Question 2</a></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html#question-3-8"><i class="fa fa-check"></i>Question 3</a></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html#question-4-6"><i class="fa fa-check"></i>Question 4</a></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html#question-5-5"><i class="fa fa-check"></i>Question 5</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://peterprevos.com/" target="blank">Dr Peter Prevos</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Science for Water Professionals - Create Value from Data with the R Language</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ggplot" class="section level1" number="6">
<h1><span class="header-section-number">Chapter 6</span> Visualising Data with ggplot2</h1>
<p>Advertising executive Fred Barnard coined the well-worn cliche that “a picture is worth (ten) thousand words” in 1927. Perhaps we should say: “A picture is worth a 1000 numbers”. A simple graph can summarise thousands of numbers and make them understandable in the blink of an eye.</p>
<p>The internet is awash with infographics and other creative methods to create images from data. However, not all data visualisations are created equal. Some graphics are hard to interpret, which can lead to wrong decisions. Others confuse or even deceive the reader. Scientists have studied how the mind perceives graphics in great depth and devised a comprehensive body of knowledge that helps us create sound, useful and aesthetic visualisations.</p>
<p>This chapter introduces some principles of best practice in data visualisation. The second part presents the <em>ggplot2</em> library and some basic techniques to create high-quality graphics. The learning objectives for this chapter are:</p>
<ul>
<li>Assess the quality of data visualisations using the data-pixel ratio.</li>
<li>Apply the principles of the <em>Grammar of Graphics</em>.</li>
<li>Visualise water quality data with the <em>ggplot2</em> library.</li>
</ul>
<p>The data for this chapter is available in the <code>casestudy1</code> folder of the RStudio project.</p>
<div id="principles-of-visualisation" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Principles of Visualisation</h2>
<p>In the <a href="datascience.html#datascience">first chapter</a> of this course, we saw how the principles of good data visualisation align with the art of architecture. Although visualising data has some parallels with art, it is a very different craft.</p>
<p>All works of art are a form of deception. An artist paints a three-dimensional world on a flat canvas, and although we see people, we are just looking at blobs of paint. Data visualisation as an art form needs to be truthful and not deceive. The purpose of any graph is to reliably reflect the data without leaving room for the viewer the interpret the scene. Following some basic rules prevents confusing the consumers of your data products.</p>
<p>Firstly, visualisation needs to have a straightforward narrative. The reader should be able to draw the intended conclusion without too much mental effort. A graphic should only tell one story, such as comparing numbers, showing a trend and so on. Charts for the sake of themselves are a useless waste of space. Many organisations maintain massive dashboards that contain everything but the kitchen sink. While these displays are impressive, they don’t necessarily add value.</p>
<p>A visualisation should ideally contain a point of interest, such as the most recent, the highest, the lowest, an exceedance or anything else worth noting.</p>
<p>Secondly, visualisations should have a minimalist design. Remove any elements that don’t add to the story, such as overuse of colour or backgrounds. Graphs with too many lines or colours confuse the reader and increase the difficulty of interpreting the information.</p>
<p>There are no formulas or algorithms that ensure perfect visualisations. The social network Reddit has two groups dedicated to visualisations. Users members of the <a href="https://reddit.com/r/dataisugly/">Data is Ugly</a> and <a href="https://reddit.com/r/dataisbeautiful/">Data is Beautiful</a> groups share images of visualisations they consider ugly or beautiful. However, what is a lovely graph to one person, is an abomination to somebody else. The aesthetics of data visualisation is for a significant part in the eye of the beholder. However, when viewing aesthetics from a practical perspective, we can define this with a simple heuristic.</p>
<div id="the-aesthetics-of-visualising-data" class="section level3" number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> The aesthetics of visualising data</h3>
<p>Data visualisations are everywhere. They are no longer the domain of scientific publications and business reports. Publications in every medium use graphs to tell stories. The internet is awash with infographics on a wide range of topics. These popular images are often not more than data porn because they are designed to entertain and titillate, with limited usability from a business or scientific perspective. They are a fantastic tool to supply information to customers but should not be used to report data science. Aesthetics in data science is not about creating works of art but about producing useful images from a business perspective.</p>
<p>Some data visualisations remind me of a <a href="https://en.wikipedia.org/wiki/Jackson_Pollock">Jackson Pollock</a> painting (Figure <a href="ggplot.html#fig:bluepoles">6.1</a>). Engineers love to maximise the number of visual elements in a graph, with lines and colours splashed across the screen. Adding too much information to a chart and using too many colours reduces its usability. When visualisations are not aesthetic, they become harder to interpret, which leads to the wrong conclusions or even deceive the viewer.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:bluepoles"></span>
<img src="images/bluepoles.jpg" alt="Jackson Pollock (1952) Blue Poles number 11. Drip Painting in enamel and aluminium paint with glass on canvas (National Gallery, Canberra. Source: Wikimedia)." width="60%" />
<p class="caption">
Figure 6.1: Jackson Pollock (1952) Blue Poles number 11. Drip Painting in enamel and aluminium paint with glass on canvas (National Gallery, Canberra. Source: Wikimedia).
</p>
</div>
<p>Perhaps a good data visualisation should look more like a painting by <a href="https://en.wikipedia.org/wiki/Piet_Mondrian">Piet Mondrian</a>, who is famous for his austere compositions with straight lines and primary colours (Figure <a href="ggplot.html#fig:mondrian">6.2</a>). Using art to explain data visualisation is not an accidental metaphor because visual art represents how the artist perceives reality. Therefore, this comparison between Pollock and Mondrian is not a judgement of their artistic abilities. For Pollock, reality was chaotic and messy, while Mondrian saw a geometric order behind the perceived world.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:mondrian"></span>
<img src="images/mondrian.jpg" alt="Piet Mondrian (1928) Composition with red, yellow and blue. Oil on canvas (Municipal Museum, the Hague)." width="40%" />
<p class="caption">
Figure 6.2: Piet Mondrian (1928) Composition with red, yellow and blue. Oil on canvas (Municipal Museum, the Hague).
</p>
</div>
<p>Edward Tufte is an American statistician who is famous for his work on visualisation. Tufte introduced the concept of the data-ink ratio. In simple terms, this ratio expresses the relationship between the ink on the paper that tells a story and the total amount of ink on the paper. Tufte argues that this ratio should be as close to one as possible. In other words, we should not use any graphical elements that don’t communicate information, such as background images, redundant lines and verbose text.</p>
<p>Now that we are in the paperless era, we can use the data-pixel ratio as a generic measure for the aesthetics of visualisations. The principle is the same as in the analogue days. Unnecessary lines, multiple colours or multiple narratives risk confusing the user of the report.</p>
<p>The data-pixel ratio is not a mathematical concept that needs to be expressed in exact numbers. Instead, this ratio is a rule-of-thumb for designers of visualisations to help them decide what to include and, more importantly, what to exclude from an image.</p>
<p>Figure <a href="ggplot.html#fig:data-pixel">6.3</a> shows an example of maximising the data-ink ratio. The bar chart on the left has a meagre data-pixel ratio. The background image of a cat might be cute and possibly even related to the topic of the visualisation, but it only distracts from the message. Using colours to identify the variables is unnecessary because the labels are at the bottom of the graph. The legend is not very functional because it also duplicates the labels. Lastly, the lines around the bars have no function.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:data-pixel"></span>
<img src="images/data-pixel-ratio.png" alt="Examples of low and high data-pixel ratios." width="100%" />
<p class="caption">
Figure 6.3: Examples of low and high data-pixel ratios.
</p>
</div>
<p>In the improved version, all unnecessary graphical elements have been removed. Assuming that the story of this graph is to compare variables, the columns have been ranked from large to small. Suppose the narrative of this graph was to compare one or more of the variables with other variables. In that case, groups of bars can be coloured to indicate the categories.</p>
<p>The basic rule of visually communicating data is to not ‘pimp’ your visualisations with unnecessary graphical elements or verbose text that does not add to the story. When visualising data, austerity is best-practice.</p>
</div>
<div id="telling-stories" class="section level3" number="6.1.2">
<h3><span class="header-section-number">6.1.2</span> Telling Stories</h3>
<p>First and foremost, visualisations need to tell a story. The story in a graph should not be a mystery novel. A visualisation should not leave the viewer in suspense but get straight to the point. There is no need for spoiler alerts as we want to create clarity, not puzzles.</p>
<p>Trying to squeeze too much information into one graph confuses the reader. Ideally, each visualisation should contain only one or two narratives. It is better to create multiple charts than to combine everything you want to visualise in one image.</p>
<p>Numerical data can contain several types of narratives. A graph can compare data points to show a trend among items or communicate differences between them. Bar charts are the best option to compare data points with each other. A line graph is possibly your best option to compare data points over time. The distribution of data points is best visualised using a histogram or a boxplot. Scatter plots or bubble charts show relationships between two or three variables (Figure <a href="ggplot.html#fig:data-stories">6.4</a>).</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:data-stories"></span>
<img src="images/stories.png" alt="Examples of stories told with quantitative data." width="100%" />
<p class="caption">
Figure 6.4: Examples of stories told with quantitative data.
</p>
</div>
<p>Every visualisation needs to tell a story and not just summarise a bunch of numbers. The detailed considerations of choosing the most suitable visualisation are outside the scope of this course. The internet contains many tools to help you with this choice. <a href="https://extremepresentation.typepad.com/blog/2008/06/visualization-taxonomies.html">Andrew Abela</a> developed one of the earliest tools to choose the most suitable visualisation. The <a href="https://www.r-graph-gallery.com/">R Graph Gallery</a> provides some guidance on the methods available in R.</p>
</div>
</div>
<div id="visualising-data-with-ggplot" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Visualising data with ggplot</h2>
<p>The Tidyverse set of packages contains <em>ggplot2</em>, one of the most powerful data visualisation tools. This package follows a layered approach to visualising data, which simplifies the process of producing sophisticated graphics. This session introduces the basics of <em>ggplot2</em> using the Gormsey water quality data from the first case study.</p>
<p>The <em>ggplot2</em> library applies the <em>Grammar of Graphics</em> developed by Leland Wilkinson, hence the gg in ggplot. This grammar is an approach to systematically create visualisations in logical layers:</p>
<ul>
<li><em>Data</em> exists at the lowest level, without which there is nothing to visualise.</li>
<li><em>Aesthetics</em> defines which graph variables are visualised and how they look (colour, line shapes and sizes).</li>
<li><em>Geometries</em> are the shapes that represent the data, such as bars, pies or lines.</li>
<li><em>Facets</em> can be used to divide a visualisation into subplots.</li>
<li><em>Statistics</em> relate to any specific transformations to summarise the data, such as trend lines.</li>
<li><em>Coordinates</em> define how data is represented on the canvas. Mostly used in mapping.</li>
<li><em>Themes</em> define all the non-data pixels (font sizes, backgrounds and so on)</li>
</ul>
<p>The <em>ggplot2</em> package uses this vocabulary and layered approach to build visualisations. The following sections show various examples using Gormsey water quality data, building complexity layer by layer.</p>
<div id="data-1" class="section level3" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> Data</h3>
<p>The <code>ggplot()</code> function always starts with the data variable, which has to be a data frame or a Tibble. If you evaluate this function with only a data frame, it will draw a canvas and nothing else (Figure <a href="ggplot.html#fig:canvas">6.5</a>). This is the canvas on which we build all further layers.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="ggplot.html#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb73-2"><a href="ggplot.html#cb73-2" aria-hidden="true" tabindex="-1"></a>gormsey <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;casestudy1/gormsey.csv&quot;</span>)</span>
<span id="cb73-3"><a href="ggplot.html#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="ggplot.html#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gormsey)</span></code></pre></div>
</div>
<div id="aesthetics" class="section level3" number="6.2.2">
<h3><span class="header-section-number">6.2.2</span> Aesthetics</h3>
<p>The next part in the <code>ggplot()</code> function defines the aesthetics, consisting of the fields in the data used in the visualisation. The example below plots the <code>gormsey</code> data frame and uses the <code>Measure</code> variable (Figure <a href="ggplot.html#fig:canvas">6.5</a>).</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="ggplot.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gormsey, <span class="fu">aes</span>(Measure))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:canvas"></span>
<img src="r4h2o_files/figure-html/canvas-1.png" alt="Empty ggplot canvases." width="50%" /><img src="r4h2o_files/figure-html/canvas-2.png" alt="Empty ggplot canvases." width="50%" />
<p class="caption">
Figure 6.5: Empty ggplot canvases.
</p>
</div>
<p>When we add the aesthetics, the <code>ggplot()</code> function draws a canvas with a spot for each of the measures on the <span class="math inline">\(x\)</span>-axis.</p>
<p>Besides the variables on the axes, you can also define colours, line types and other data-related design elements in the aesthetics, but they will only be visible once you define a geometry, discussed in the next section.</p>
<blockquote>
<p>What will be the result of using <code>aes(x = Date, y = Result)</code>?</p>
</blockquote>
</div>
<div id="geometries" class="section level3" number="6.2.3">
<h3><span class="header-section-number">6.2.3</span> Geometries</h3>
<p>To visualise the aesthetics, we need to add a geometry that defines the shapes on the canvas. In <em>ggplot2</em>, all geometries start with <code>geom_</code>. You can explore them easily by typing the first few letters and hitting the TAB button to view the completion options. The <em>ggplot2</em> package includes the most common shapes to visualise data, and other developers have shared more specialised geometries.</p>
<p>The <em><a href="https://ggplot2.tidyverse.org/">ggplot2</a></em> website provides detailed descriptions of each of the available geometries. This chapter introduces some of the most commonly used geometries.</p>
<p>Given that the measure name is a qualitative variable, we can only visualise this data to count the number of samples in each town. The <code>geom_bar()</code> geometry counts the number of occurrences of each data point and plots them as a bar chart (Figure <a href="ggplot.html#fig:barplot">6.6</a>).</p>
<p>The <code>ggplot()</code> function passes the first variable in the aesthetics to the geometry. The bar geometry then counts the number of elements for each category in the <code>Measure</code> variable. If you don’t write anything between the parenthesis in the geometry, then the function creates a simple grey chart (Figure <a href="ggplot.html#fig:barplot">6.6</a>). The paradigm of maximising the data-pixel ratio suggests that colour should only be used to visualise data. Since we did not instruct R to use colour, it uses grey.</p>
<p>In <em>ggplot2</em>, the layers are connected with a <code>+</code> sign. In computer science terminology, the plus sign is a pipe, which means that the result from the code before the symbol is moved (piped) to the next section. It expresses that the layers are superimposed on top of each other. If you evaluate layers by themselves, it will result in either an empty canvas or an error.</p>
<p>It is common practice to start a new line after each layer to create readable code. RStudio automatically indents the code so that you know which lines belong together. If your code becomes messy, then you can use <code>Crtl-i</code> to align the text.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="ggplot.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gormsey, <span class="fu">aes</span>(Measure)) <span class="sc">+</span> </span>
<span id="cb75-2"><a href="ggplot.html#cb75-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:barplot"></span>
<img src="r4h2o_files/figure-html/barplot-1.png" alt="Bar chart of the number of samples for each town." width="80%" />
<p class="caption">
Figure 6.6: Bar chart of the number of samples for each town.
</p>
</div>
</div>
</div>
<div id="colour-aesthetics" class="section level2" number="6.3">
<h2><span class="header-section-number">6.3</span> Colour Aesthetics</h2>
<p>You can add colour to express data to comply with a style guide by using <code>geom_bar(fill = "royalblue")</code>, or any other colour you fancy.</p>
<p>The primary colours, such as red, green, blue, and many more subtle shades, can be mentioned by name. You can see a complete list of the 657 colour name with <code>colors()</code>. The <a href="http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf">University of Columbia</a> hosts a helpful PDF document with a sample of the available colours. Which one is your favourite?</p>
<p>R also understands colour colours in HTML <a href="https://www.w3schools.com/colors/colors_picker.asp">hex codes</a>. These codes consist of three hexadecimal numbers (ranging from 00 (0) to FF (255)) for each red, green and blue. The hex code <code>#FF0000</code> results in purely red colour, <code>#00FF00</code> is green. Mixing these three primary colours results in a palette of 16 million theoretical colours; for example, <code>#78417A</code> forms a deep purple.</p>
<blockquote>
<p><strong>Practice Task</strong>: Add your favourite colour to the bar plot.</p>
</blockquote>
<p>Adding colour directly into the geometry will give everything the same colour but the colour does not express data. Using the aesthetics function, you can assign colours to data.</p>
<p>The example below creates a time series chart of the turbidity results in Gormsey. The <code>col = Town</code> part in the aesthetics instructs ggplot to draw a line for each town and give it a different colour (figure <a href="ggplot.html#fig:timeseries">6.7</a>).</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="ggplot.html#cb76-1" aria-hidden="true" tabindex="-1"></a>turbidity <span class="ot">&lt;-</span> <span class="fu">filter</span>(gormsey, Measure <span class="sc">==</span> <span class="st">&quot;Turbidity&quot;</span>)</span>
<span id="cb76-2"><a href="ggplot.html#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="ggplot.html#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(turbidity, <span class="fu">aes</span>(Date, Result, <span class="at">col =</span> Town)) <span class="sc">+</span> </span>
<span id="cb76-4"><a href="ggplot.html#cb76-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:timeseries"></span>
<img src="r4h2o_files/figure-html/timeseries-1.png" alt="Gormsey turbidity time series." width="80%" />
<p class="caption">
Figure 6.7: Gormsey turbidity time series.
</p>
</div>
<p>This example is not an optimal use of this functionality because there are too many lines, which are hard to read. Referring back to the visual arts, this graph is a bit like a Jackson Pollock action painting (Figure <a href="ggplot.html#fig:bluepoles">6.1</a>). We can fix this with the next layer, the facets.</p>
<p>Two colour aesthetics are available: <code>col</code> and <code>fill</code>. The former defines the colour of lines, like in figure <a href="ggplot.html#fig:timeseries">6.7</a>, while the latter describes the colours of shapes.</p>
<p>The <em>ggplot2</em> package assigns a default scheme to each colour aesthetic, which you can obviously change. Choosing the optimal colour scheme is part art and part science. There is basically three types of colour schemes (Figure <a href="ggplot.html#fig:colorbrewer">6.8</a>):</p>
<ul>
<li>Sequential</li>
<li>Diverging</li>
<li>Qualitative</li>
</ul>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:colorbrewer"></span>
<img src="images/colorbrewer.png" alt="Three types of colour schemes." width="40%" />
<p class="caption">
Figure 6.8: Three types of colour schemes.
</p>
</div>
<p>Sequential schemes contain a series of colours with increasing strength. These colour schemes are most suitable to visualise magnitude from low to high, with light colours usually for low data values and dark colours for high values. The dark colour will grab the viewer’s attention, while the light colours fade into the background.</p>
<p>Diverging colours visualise deviations from a norm, such as droughts or floods or water consumption. Green, amber and red are the most common use of this type of palette as business reports are filled with traffic lights to report progress. This type of reporting helps managers focus on problem areas to discuss actions to improve future performance.</p>
<p>A note of caution is that this technique does not work for people with green/red colour blindness. This condition is not a problem with real traffic lights as the order of the lights is always the same. However, on a business report, the colours will all look the same to roughly eight per cent of men and one percent of women with this condition. The Colorbrewer website lets you choose colourblind-safe palettes.</p>
<p>Qualitative colours are palettes that are aesthetically compatible but without a logical relationship with the data. These palettes can express qualitative values such as categories, such as the name of a town.</p>
<blockquote>
<p><strong>Practice Task</strong>: Which type of colour scheme is used in the line chart in figure <a href="ggplot.html#fig:timeseries">6.7</a>?</p>
</blockquote>
<p>The R language has many packages that define specific colour pallets. Emil Hvitfeldt has curated a collection of hundreds of <a href="https://github.com/EmilHvitfeldt/r-color-palettes">R colour palettes</a> to use in your visualisations.</p>
<p>Cartographers Mark Harrower and Cynthia Brewer developed the Color Brewer system (<a href="http://colorbrewer2.org/">colorbrewer2.org</a>) to help designers of visualisations select a helpful scheme. These colour schemes are designed for choropleth maps but can also be used for non-spatial visualisations.</p>
<p>The <em>ggplot2</em> library includes predefined colour palettes, such as the Color Brewer (Figure <a href="ggplot.html#fig:cbex">6.9</a>). The <code>scale_fill_brewer()</code> function assigns the palette to the fill aesthetic. In this case, we have chosen the qualitative palette “Dark2”.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="ggplot.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gormsey, <span class="fu">aes</span>(Town, <span class="at">fill =</span> Measure)) <span class="sc">+</span></span>
<span id="cb77-2"><a href="ggplot.html#cb77-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb77-3"><a href="ggplot.html#cb77-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_brewer</span>(<span class="at">type =</span> <span class="st">&quot;qual&quot;</span>,</span>
<span id="cb77-4"><a href="ggplot.html#cb77-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">palette =</span> <span class="st">&quot;Dark2&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:cbex"></span>
<img src="r4h2o_files/figure-html/cbex-1.png" alt="Color Brewer example" width="100%" />
<p class="caption">
Figure 6.9: Color Brewer example
</p>
</div>
<p>You can see all the palettes in the Color Brewer schemes by invoking the <em>RColorBrewer</em> package:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="ggplot.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb78-2"><a href="ggplot.html#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">display.brewer.all</span>() </span></code></pre></div>
<p>Various other palettes are available, which you can find by using the tab key completion system. Note that when you use the <code>col</code> aesthetic for lines, you need to use the <code>scale_color_brewer()</code> function to assign a palette. In some visualisation, you might define a different palette for fills and lines by using both versions.</p>
<p>The <code>scale_fill_manual()</code> and <code>scale_color_manual()</code> functions let you define your own scheme, for example the corporate style guide. You define the colour with the values parameter. You just need to ensure that the number of colours matches the number of unique values in your aesthetics. You can use the colour names or their hexadecimal values mentioned above, for example:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="ggplot.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gormsey, <span class="fu">aes</span>(Town, <span class="at">fill =</span> Measure)) <span class="sc">+</span></span>
<span id="cb79-2"><a href="ggplot.html#cb79-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb79-3"><a href="ggplot.html#cb79-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;cornflowerblue&quot;</span>,</span>
<span id="cb79-4"><a href="ggplot.html#cb79-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;darkseagreen&quot;</span>,</span>
<span id="cb79-5"><a href="ggplot.html#cb79-5" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;#ee6611&quot;</span>,</span>
<span id="cb79-6"><a href="ggplot.html#cb79-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;#ccaa44&quot;</span>))</span></code></pre></div>
<div id="facets" class="section level3" number="6.3.1">
<h3><span class="header-section-number">6.3.1</span> Facets</h3>
<p>The time series plotted in Figure <a href="ggplot.html#fig:timeseries">6.7</a> was confusing because there were too many lines on the canvas. A facet allows us to combine multiple plots in one visualisation.</p>
<p>The example below uses the <code>facet_wrap()</code> function to create separate time series for each town. The wrap function finds the best way to fit them on the canvas (Figure <a href="ggplot.html#fig:facet">6.10</a>). Note the tilde at the start of the facet parameter.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="ggplot.html#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(turbidity, <span class="fu">aes</span>(Date, Result, <span class="at">col =</span> Town)) <span class="sc">+</span> </span>
<span id="cb80-2"><a href="ggplot.html#cb80-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb80-3"><a href="ggplot.html#cb80-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>Town)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:facet"></span>
<img src="r4h2o_files/figure-html/facet-1.png" alt="Faceted plot of turbidity in water quality zones." width="672" />
<p class="caption">
Figure 6.10: Faceted plot of turbidity in water quality zones.
</p>
</div>
<blockquote>
<p><strong>Practice Task</strong>: This plot contains one redundant part. Which one can you remove without changing the story and clarity of the visualisation?</p>
</blockquote>
<p>Facets can also be by two variables. The example below plots a grid with a time series for each town (rows), for each measure (columns). The <code>scales = "free_y"</code> parameter sets a different <span class="math inline">\(y\)</span> scale for each row because the scaling between measures has a wide range (figure <a href="#fig:facets"><strong>??</strong></a>).</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="ggplot.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gormsey, <span class="fu">aes</span>(Date, Result)) <span class="sc">+</span></span>
<span id="cb81-2"><a href="ggplot.html#cb81-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb81-3"><a href="ggplot.html#cb81-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(Town<span class="sc">~</span>Measure, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<p>Note that these graphs suffer from a defect because the dates overlap. We will see how to fix this in the section about coordinates.</p>
<p>Facets are an efficient and commonly used method to communicate multivariate data within one visualisation, without uncompromising readability.</p>
</div>
<div id="statistics-1" class="section level3" number="6.3.2">
<h3><span class="header-section-number">6.3.2</span> Statistics</h3>
<p>Now that we have a powerful tool to visualise data, we also want to add additional elements to tell a story. At the moment, our time series is just a series of lines without any context. The statistics layer add summaries and reference points for the viewer to see the data in context.</p>
<p>The example in figure <a href="ggplot.html#fig:thm">6.11</a> adds two further layers to add context. The first three lines create a data frame with the highest measured THM value for each day.</p>
<p>The <code>geom_smooth()</code> function draws a regression line on the canvas. The <a href="https://en.wikipedia.org/wiki/Local_regression">Loess function</a> is the default method, but it can also be used for linear and regression models with the <code>method</code> parameter. Note how the smoothing line is drawn first, so it stays in the background. Subsequent geometries are plotted on top of the previous ones.</p>
<p>The story is completed by drawing a red horizontal line at 0.25 mg/l, the regulatory limit, using the <code>geom_hline()</code> geometry. You can add vertical lines with the <code>geom_vline()</code> geometry.</p>
<p>We have now reached a point where a graph tells a complete story. This visualisation tells us that there is a flat trend in THMs. Still, we had several spikes above the regulatory limits.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="ggplot.html#cb82-1" aria-hidden="true" tabindex="-1"></a>thm <span class="ot">&lt;-</span> <span class="fu">filter</span>(gormsey, Measure <span class="sc">==</span> <span class="st">&quot;THM&quot;</span>)</span>
<span id="cb82-2"><a href="ggplot.html#cb82-2" aria-hidden="true" tabindex="-1"></a>thm_grouped <span class="ot">&lt;-</span> <span class="fu">group_by</span>(thm, Date)</span>
<span id="cb82-3"><a href="ggplot.html#cb82-3" aria-hidden="true" tabindex="-1"></a>thm_max <span class="ot">&lt;-</span> <span class="fu">summarise</span>(thm_grouped, <span class="at">thm_max =</span> <span class="fu">max</span>(Result))</span>
<span id="cb82-4"><a href="ggplot.html#cb82-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-5"><a href="ggplot.html#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(thm_max, <span class="fu">aes</span>(Date, thm_max)) <span class="sc">+</span> </span>
<span id="cb82-6"><a href="ggplot.html#cb82-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="sc">+</span> </span>
<span id="cb82-7"><a href="ggplot.html#cb82-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb82-8"><a href="ggplot.html#cb82-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.25</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:thm"></span>
<img src="r4h2o_files/figure-html/thm-1.png" alt="THM Trends." width="80%" />
<p class="caption">
Figure 6.11: THM Trends.
</p>
</div>
<blockquote>
<p><strong>Practice Task</strong>: Convert this visualisation to a faceted graph to show the trend per system.</p>
</blockquote>
</div>
<div id="coordinates" class="section level3" number="6.3.3">
<h3><span class="header-section-number">6.3.3</span> Coordinates</h3>
<p>The penultimate layer defines how we display the coordinate system. The <em>ggplot2</em> package can display the standard Cartesian coordinates but also polar and various mapping systems. For now, we will stick to the Cartesian system. All mapping layers star with <code>coord_</code>, which you can explore the usual way.</p>
<p>Box plots are a helpful geometry to communicate the distribution of results (<a href="ggplot.html#fig:boxplot">6.12</a>).</p>
<p>The upper whisker extends from the hinge to the largest value, no further than 1.5 times the inter-quartile range (IQR) or distance between the first and third quartile. Likewise, the lower whisker extends from the hinge to the smallest value at most 1.5 IQR of the hinge.</p>
<p>Data beyond the end of the whiskers are called “outlying” points and are plotted individually. The box plot provides an instant summary of the distribution of your data.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="ggplot.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(turbidity, <span class="fu">aes</span>(Town, Result)) <span class="sc">+</span> </span>
<span id="cb83-2"><a href="ggplot.html#cb83-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span> </span>
<span id="cb83-3"><a href="ggplot.html#cb83-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_log10</span>(<span class="at">name =</span> <span class="st">&quot;Samples (log)&quot;</span>,</span>
<span id="cb83-4"><a href="ggplot.html#cb83-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">n.breaks =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb83-5"><a href="ggplot.html#cb83-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:boxplot"></span>
<img src="r4h2o_files/figure-html/boxplot-1.png" alt="Box plot of turbidity in water quality zones." width="80%" />
<p class="caption">
Figure 6.12: Box plot of turbidity in water quality zones.
</p>
</div>
<p>If we pass one value to the box plot aesthetic, then only one box is plotted. If we add a second value, then ggplot will group the data by that variable.</p>
<p>The third line introduces a new layer that converts the <span class="math inline">\(y\)</span>-axis to a logarithmic scale because the data in one town is positively skewed. Without this transformation, the visualisation will be challenging to read.</p>
<p>You can define the <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>-axes with the <code>scale_*</code> set of functions. This functionality transforms scales, but it also always you to define how the scale is displayed. Some of the most common functions in this group are:</p>
<ul>
<li><code>scale_x_log10()</code>: Logarithmic scale.</li>
<li><code>scale_x_discrete()</code>: Discrete variables (names).</li>
<li><code>scale_x_continuous()</code>: Continuous variables, such as measurements.</li>
<li><code>scale_x_date()</code>: For displaying dates and times.</li>
</ul>
<p>The <code>scale_*</code> series of functions have several parameters, for example:</p>
<p>The scale layer also sets the name for the <span class="math inline">\(y\)</span>-axis to “Samples” and displays up to 10 breaks. Further parameters are available to fine-tune how axes are displayed. More advanced examples in the following chapters provide some more guidance.</p>
<p>The <code>coord-flip()</code> transformation flips the two axes. This was needed because the names of the towns can overlap when the <span class="math inline">\(x\)</span>-axis is horizontal.</p>
<p>To prevent the overlap of dates in the timeseries graph in figure <a href="#fig:facets"><strong>??</strong></a> we need to define how dates are displayed, which is explained in more detail in chapter 12.</p>
</div>
<div id="theme" class="section level3" number="6.3.4">
<h3><span class="header-section-number">6.3.4</span> Theme</h3>
<p>The theme of a graph defines the aesthetic aspects of the background, fonts, axes and so on. The <em>ggplot2</em> library has extensive options to change the theme of a graph. Every element of the canvas colours and lines, text sizes, fonts, and so on can be changed. This is quite a complex topic due to the countless variations.</p>
<p>The <em>ggplot2</em> package contains a collection of predefined themes. To use one of these themes, simply add <code>theme_name()</code> to the <em>ggplot</em> call and replace <code>name</code> with the name of the theme, for example:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="ggplot.html#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(turbidity, <span class="fu">aes</span>(Date, Result)) <span class="sc">+</span> </span>
<span id="cb84-2"><a href="ggplot.html#cb84-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb84-3"><a href="ggplot.html#cb84-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>Town, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb84-4"><a href="ggplot.html#cb84-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span></code></pre></div>
<p>You can try different themes by typing <code>theme_</code> and hitting the tab button to see the available themes.</p>
<p>The writing in ggplot can sometimes be a bit small, and you can change this with the <code>base_size = x</code> option, where <code>x</code> is an integer.</p>
<blockquote>
<p>Try various themes and select the one that suits you best.</p>
</blockquote>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:themes"></span>
<img src="r4h2o_files/figure-html/themes-1.png" alt="Some examples of ggplot themes." width="80%" />
<p class="caption">
Figure 6.13: Some examples of ggplot themes.
</p>
</div>
<p>The void theme removes all axes and background, so we only see the geometries. This code creates eleven lines that communicate the trend to the viewer, without worrying about the mathematical details (Figure <a href="ggplot.html#fig:sparks">6.14</a>), a so-called sparkline.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="ggplot.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(turbidity, <span class="fu">aes</span>(Date, Result)) <span class="sc">+</span> </span>
<span id="cb85-2"><a href="ggplot.html#cb85-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_area</span>(<span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span> </span>
<span id="cb85-3"><a href="ggplot.html#cb85-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>Town, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb85-4"><a href="ggplot.html#cb85-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:sparks"></span>
<img src="r4h2o_files/figure-html/sparks-1.png" alt="Void theme for time series." width="80%" />
<p class="caption">
Figure 6.14: Void theme for time series.
</p>
</div>
<p>The graphs we have created so far don’t include much context to know what we are looking at. The <code>labs()</code> function is useful to add text to the plot and change the axes labels, as shown in the example below (Figure <a href="ggplot.html#fig:labels">6.15</a>). Adding text to the plot prevents any confusion in case the file is separated from its context.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="ggplot.html#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">filter</span>(turbidity, Town <span class="sc">==</span> <span class="st">&quot;Tarnstead&quot;</span>), <span class="fu">aes</span>(Date, Result)) <span class="sc">+</span> </span>
<span id="cb86-2"><a href="ggplot.html#cb86-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb86-3"><a href="ggplot.html#cb86-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">5</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span> </span>
<span id="cb86-4"><a href="ggplot.html#cb86-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Turbidity Spikes&quot;</span>, </span>
<span id="cb86-5"><a href="ggplot.html#cb86-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">&quot;Strathmore customer taps&quot;</span>,</span>
<span id="cb86-6"><a href="ggplot.html#cb86-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">caption =</span> <span class="st">&quot;Source: Gormsey laboratory&quot;</span>,</span>
<span id="cb86-7"><a href="ggplot.html#cb86-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">&quot;Date sampled&quot;</span>, <span class="at">y =</span> <span class="st">&quot;NTU&quot;</span>) <span class="sc">+</span> </span>
<span id="cb86-8"><a href="ggplot.html#cb86-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">10</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:labels"></span>
<img src="r4h2o_files/figure-html/labels-1.png" alt="Adding text to a plot." width="80%" />
<p class="caption">
Figure 6.15: Adding text to a plot.
</p>
</div>
<p>This visualisation is an example of a complete data story. Anyone looking at this graph has all information available to conclude that we had three spikes of turbidity data in Strathmore, sourced from the Gormsey laboratory. The chart is easy to read, and the criterion for what constitutes a spike is also visible.</p>
<p>The <em>ggplot2</em> package has extensive capabilities to []finetune the design](<a href="https://ggplot2.tidyverse.org/reference/theme.html" class="uri">https://ggplot2.tidyverse.org/reference/theme.html</a>) of a visualisation. The example below rotates the text on the <span class="math inline">\(x\)</span>-axis by 90 degrees.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="ggplot.html#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gormsey, <span class="fu">aes</span>(Measure)) <span class="sc">+</span></span>
<span id="cb87-2"><a href="ggplot.html#cb87-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb87-3"><a href="ggplot.html#cb87-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>))</span></code></pre></div>
<p><img src="r4h2o_files/figure-html/unnamed-chunk-44-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="sharing-visualisations" class="section level2" number="6.4">
<h2><span class="header-section-number">6.4</span> Sharing visualisations</h2>
<p>Showing the graphs on the screen is fine, but you will most likely want to share it with colleagues. The <code>ggsave()</code> function provides a convenient method to save a <em>ggplot2</em> graph to a file in png, pdf, jpg or many other formats.</p>
<p>The default settings save the figure at a high resolution of 300 DPI, suitable for printed publications. The width and height default to inches. You can also set the <code>units</code> parameter to change this to mm or pixels.</p>
<p>The <code>ggsave()</code> function always saves the most recent plot.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="ggplot.html#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;test.png&quot;</span>, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">4</span>)</span></code></pre></div>
</div>
<div id="further-study-4" class="section level2" number="6.5">
<h2><span class="header-section-number">6.5</span> Further Study</h2>
<p>This chapter is only a brief overview of <em>ggplot2</em>, focusing on the principles. However, the capabilities of this package are extensive and far beyond what can be covered in one chapter. Further examples in this book show more advanced uses of this package.</p>
<p>The Tidyverse website contains comprehensive information about the <em>ggplot2</em> package.</p>
<p>The RStudio <a href="https://raw.githubusercontent.com/rstudio/cheatsheets/master/data-visualization-2.1.pdf">Data Visualisation Cheat Sheet</a> provides a comprehensive summary of the functionality on one double-sided A3 PDF file.</p>
<p>The <a href="dataproducts.html#dataproducts">next chapter</a> discusses a reproducible method to share the results of your analysis with colleagues or the general public with a PowerPoint slide deck.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="statistics.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="dataproducts.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/pprevos/r4h2o/edit/master/06_visualise.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/pprevos/r4h2o/r4h2o-book/blob/master/06_visualise.Rmd",
"text": null
},
"download": ["r4h2o.pdf", "r4h2o.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
