<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Cleaning Data | Data Science for Water Professionals - Create Value from Data with the R Language</title>
  <meta name="description" content="Data science course for water management professionals using the R language. This course is developed for water professionals with little to no experience in writing code to analyse data." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Cleaning Data | Data Science for Water Professionals - Create Value from Data with the R Language" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://lucidmanager.org/r4h2o" />
  <meta property="og:image" content="https://lucidmanager.org/r4h2o/images/r4h2o-cover.jpg" />
  <meta property="og:description" content="Data science course for water management professionals using the R language. This course is developed for water professionals with little to no experience in writing code to analyse data." />
  <meta name="github-repo" content="pprevos/r4h2o" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Cleaning Data | Data Science for Water Professionals - Create Value from Data with the R Language" />
  
  <meta name="twitter:description" content="Data science course for water management professionals using the R language. This course is developed for water professionals with little to no experience in writing code to analyse data." />
  <meta name="twitter:image" content="https://lucidmanager.org/r4h2o/images/r4h2o-cover.jpg" />

<meta name="author" content="Dr Peter Prevos" />


<meta name="date" content="2021-11-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="dataproducts.html"/>
<link rel="next" href="customers.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Science for Water Professionals</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#learning-objectives"><i class="fa fa-check"></i><b>1.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#prerequisites"><i class="fa fa-check"></i><b>1.2</b> Prerequisites</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#case-study-approach"><i class="fa fa-check"></i><b>1.3</b> Case Study approach</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="introduction.html"><a href="introduction.html#case-study-1-water-quality-regulations"><i class="fa fa-check"></i><b>1.3.1</b> Case Study 1: Water Quality Regulations</a></li>
<li class="chapter" data-level="1.3.2" data-path="introduction.html"><a href="introduction.html#case-study-2-customer-experience"><i class="fa fa-check"></i><b>1.3.2</b> Case Study 2: Customer Experience</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="datascience.html"><a href="datascience.html"><i class="fa fa-check"></i><b>2</b> Principles of Water Utility Data Science</a>
<ul>
<li class="chapter" data-level="2.1" data-path="datascience.html"><a href="datascience.html#what-is-data-science"><i class="fa fa-check"></i><b>2.1</b> What is data science?</a></li>
<li class="chapter" data-level="2.2" data-path="datascience.html"><a href="datascience.html#the-elements-of-data-science"><i class="fa fa-check"></i><b>2.2</b> The Elements of Data Science</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="datascience.html"><a href="datascience.html#domain-knowledge"><i class="fa fa-check"></i><b>2.2.1</b> Domain Knowledge</a></li>
<li class="chapter" data-level="2.2.2" data-path="datascience.html"><a href="datascience.html#mathematical-knowledge"><i class="fa fa-check"></i><b>2.2.2</b> Mathematical Knowledge</a></li>
<li class="chapter" data-level="2.2.3" data-path="datascience.html"><a href="datascience.html#computer-science"><i class="fa fa-check"></i><b>2.2.3</b> Computer Science</a></li>
<li class="chapter" data-level="2.2.4" data-path="datascience.html"><a href="datascience.html#the-unicorn-data-scientist"><i class="fa fa-check"></i><b>2.2.4</b> The Unicorn Data Scientist?</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="datascience.html"><a href="datascience.html#the-water-data-value-chain-the-digital-water-utility"><i class="fa fa-check"></i><b>2.3</b> The Water-Data Value Chain: The Digital Water Utility</a></li>
<li class="chapter" data-level="2.4" data-path="datascience.html"><a href="datascience.html#data-science-tools"><i class="fa fa-check"></i><b>2.4</b> Data Science Tools</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="datascience.html"><a href="datascience.html#spreadsheets"><i class="fa fa-check"></i><b>2.4.1</b> Spreadsheets</a></li>
<li class="chapter" data-level="2.4.2" data-path="datascience.html"><a href="datascience.html#business-intelligence-systems"><i class="fa fa-check"></i><b>2.4.2</b> Business Intelligence Systems</a></li>
<li class="chapter" data-level="2.4.3" data-path="datascience.html"><a href="datascience.html#data-science-code"><i class="fa fa-check"></i><b>2.4.3</b> Data science code</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="datascience.html"><a href="datascience.html#good-data-science"><i class="fa fa-check"></i><b>2.5</b> Good Data Science</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="datascience.html"><a href="datascience.html#data-science-trivium"><i class="fa fa-check"></i><b>2.5.1</b> Data Science Trivium</a></li>
<li class="chapter" data-level="2.5.2" data-path="datascience.html"><a href="datascience.html#useful-data-science"><i class="fa fa-check"></i><b>2.5.2</b> Useful Data Science</a></li>
<li class="chapter" data-level="2.5.3" data-path="datascience.html"><a href="datascience.html#reality"><i class="fa fa-check"></i><b>2.5.3</b> Reality</a></li>
<li class="chapter" data-level="2.5.4" data-path="datascience.html"><a href="datascience.html#data"><i class="fa fa-check"></i><b>2.5.4</b> Data</a></li>
<li class="chapter" data-level="2.5.5" data-path="datascience.html"><a href="datascience.html#information"><i class="fa fa-check"></i><b>2.5.5</b> Information</a></li>
<li class="chapter" data-level="2.5.6" data-path="datascience.html"><a href="datascience.html#knowledge"><i class="fa fa-check"></i><b>2.5.6</b> Knowledge</a></li>
<li class="chapter" data-level="2.5.7" data-path="datascience.html"><a href="datascience.html#feedback-loop"><i class="fa fa-check"></i><b>2.5.7</b> Feedback Loop</a></li>
<li class="chapter" data-level="2.5.8" data-path="datascience.html"><a href="datascience.html#sound-data-science"><i class="fa fa-check"></i><b>2.5.8</b> Sound Data Science</a></li>
<li class="chapter" data-level="2.5.9" data-path="datascience.html"><a href="datascience.html#aesthetic-data-science"><i class="fa fa-check"></i><b>2.5.9</b> Aesthetic Data Science</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="datascience.html"><a href="datascience.html#best-practice-data-science-with-r"><i class="fa fa-check"></i><b>2.6</b> Best-Practice Data Science with R</a></li>
<li class="chapter" data-level="2.7" data-path="datascience.html"><a href="datascience.html#further-study"><i class="fa fa-check"></i><b>2.7</b> Further Study</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="basics.html"><a href="basics.html"><i class="fa fa-check"></i><b>3</b> Introduction to the R Language</a>
<ul>
<li class="chapter" data-level="3.1" data-path="basics.html"><a href="basics.html#the-r-language"><i class="fa fa-check"></i><b>3.1</b> The R Language</a></li>
<li class="chapter" data-level="3.2" data-path="basics.html"><a href="basics.html#basic-principles-of-programming"><i class="fa fa-check"></i><b>3.2</b> Basic principles of programming</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="basics.html"><a href="basics.html#understanding-computer-code"><i class="fa fa-check"></i><b>3.2.1</b> Understanding computer code</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="basics.html"><a href="basics.html#debugging-code"><i class="fa fa-check"></i><b>3.3</b> Debugging Code</a></li>
<li class="chapter" data-level="3.4" data-path="basics.html"><a href="basics.html#using-r-and-rstudio"><i class="fa fa-check"></i><b>3.4</b> Using R and RStudio</a></li>
<li class="chapter" data-level="3.5" data-path="basics.html"><a href="basics.html#basics-of-the-r-language"><i class="fa fa-check"></i><b>3.5</b> Basics of the R language</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="basics.html"><a href="basics.html#arithmetic"><i class="fa fa-check"></i><b>3.5.1</b> Arithmetic</a></li>
<li class="chapter" data-level="3.5.2" data-path="basics.html"><a href="basics.html#variables"><i class="fa fa-check"></i><b>3.5.2</b> Variables</a></li>
<li class="chapter" data-level="3.5.3" data-path="basics.html"><a href="basics.html#vectors"><i class="fa fa-check"></i><b>3.5.3</b> Vectors</a></li>
<li class="chapter" data-level="3.5.4" data-path="basics.html"><a href="basics.html#basic-plots"><i class="fa fa-check"></i><b>3.5.4</b> Basic plots</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="basics.html"><a href="basics.html#rstudio-scripts-and-projects"><i class="fa fa-check"></i><b>3.6</b> RStudio scripts and projects</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="basics.html"><a href="basics.html#finding-help"><i class="fa fa-check"></i><b>3.6.1</b> Finding help</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="basics.html"><a href="basics.html#quiz-1-calculating-channel-flows"><i class="fa fa-check"></i><b>3.7</b> Quiz 1: Calculating channel flows</a></li>
<li class="chapter" data-level="3.8" data-path="basics.html"><a href="basics.html#further-study-1"><i class="fa fa-check"></i><b>3.8</b> Further Study</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="tidyverse.html"><a href="tidyverse.html"><i class="fa fa-check"></i><b>4</b> Exploring Data with the Tidyverse Packages</a>
<ul>
<li class="chapter" data-level="4.1" data-path="tidyverse.html"><a href="tidyverse.html#r-libraries"><i class="fa fa-check"></i><b>4.1</b> R Libraries</a></li>
<li class="chapter" data-level="4.2" data-path="tidyverse.html"><a href="tidyverse.html#introducing-the-tidyverse"><i class="fa fa-check"></i><b>4.2</b> Introducing the Tidyverse</a></li>
<li class="chapter" data-level="4.3" data-path="tidyverse.html"><a href="tidyverse.html#case-study-1"><i class="fa fa-check"></i><b>4.3</b> Case Study 1</a></li>
<li class="chapter" data-level="4.4" data-path="tidyverse.html"><a href="tidyverse.html#exploring-the-case-study-data"><i class="fa fa-check"></i><b>4.4</b> Exploring the Case Study Data</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="tidyverse.html"><a href="tidyverse.html#inspect-the-data"><i class="fa fa-check"></i><b>4.4.1</b> Inspect the data</a></li>
<li class="chapter" data-level="4.4.2" data-path="tidyverse.html"><a href="tidyverse.html#explore-the-data"><i class="fa fa-check"></i><b>4.4.2</b> Explore the data</a></li>
<li class="chapter" data-level="4.4.3" data-path="tidyverse.html"><a href="tidyverse.html#explore-variables"><i class="fa fa-check"></i><b>4.4.3</b> Explore variables</a></li>
<li class="chapter" data-level="4.4.4" data-path="tidyverse.html"><a href="tidyverse.html#filtering-data"><i class="fa fa-check"></i><b>4.4.4</b> Filtering data</a></li>
<li class="chapter" data-level="4.4.5" data-path="tidyverse.html"><a href="tidyverse.html#counting-results"><i class="fa fa-check"></i><b>4.4.5</b> Counting results</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="tidyverse.html"><a href="tidyverse.html#quiz-2-exploring-water-quality-data"><i class="fa fa-check"></i><b>4.5</b> Quiz 2: Exploring Water Quality Data</a></li>
<li class="chapter" data-level="4.6" data-path="tidyverse.html"><a href="tidyverse.html#further-study-2"><i class="fa fa-check"></i><b>4.6</b> Further Study</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="statistics.html"><a href="statistics.html"><i class="fa fa-check"></i><b>5</b> Descriptive Statistics</a>
<ul>
<li class="chapter" data-level="5.1" data-path="statistics.html"><a href="statistics.html#problem-statement"><i class="fa fa-check"></i><b>5.1</b> Problem Statement</a></li>
<li class="chapter" data-level="5.2" data-path="statistics.html"><a href="statistics.html#analyse-the-data"><i class="fa fa-check"></i><b>5.2</b> Analyse the Data</a></li>
<li class="chapter" data-level="5.3" data-path="statistics.html"><a href="statistics.html#calculating-percentiles"><i class="fa fa-check"></i><b>5.3</b> Calculating Percentiles</a></li>
<li class="chapter" data-level="5.4" data-path="statistics.html"><a href="statistics.html#analysing-grouped-data"><i class="fa fa-check"></i><b>5.4</b> Analysing Grouped Data</a></li>
<li class="chapter" data-level="5.5" data-path="statistics.html"><a href="statistics.html#quiz-3-analysing-water-quality-data"><i class="fa fa-check"></i><b>5.5</b> Quiz 3: Analysing Water Quality Data</a></li>
<li class="chapter" data-level="5.6" data-path="statistics.html"><a href="statistics.html#further-study-3"><i class="fa fa-check"></i><b>5.6</b> Further Study</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="ggplot.html"><a href="ggplot.html"><i class="fa fa-check"></i><b>6</b> Visualising Data with ggplot2</a>
<ul>
<li class="chapter" data-level="6.1" data-path="ggplot.html"><a href="ggplot.html#principles-of-visualisation"><i class="fa fa-check"></i><b>6.1</b> Principles of Visualisation</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="ggplot.html"><a href="ggplot.html#the-aesthetics-of-visualising-data"><i class="fa fa-check"></i><b>6.1.1</b> The aesthetics of visualising data</a></li>
<li class="chapter" data-level="6.1.2" data-path="ggplot.html"><a href="ggplot.html#telling-stories"><i class="fa fa-check"></i><b>6.1.2</b> Telling Stories</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="ggplot.html"><a href="ggplot.html#visualising-data-with-ggplot"><i class="fa fa-check"></i><b>6.2</b> Visualising data with ggplot</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="ggplot.html"><a href="ggplot.html#aesthetics"><i class="fa fa-check"></i><b>6.2.1</b> Aesthetics</a></li>
<li class="chapter" data-level="6.2.2" data-path="ggplot.html"><a href="ggplot.html#geometries"><i class="fa fa-check"></i><b>6.2.2</b> Geometries</a></li>
<li class="chapter" data-level="6.2.3" data-path="ggplot.html"><a href="ggplot.html#facets"><i class="fa fa-check"></i><b>6.2.3</b> Facets</a></li>
<li class="chapter" data-level="6.2.4" data-path="ggplot.html"><a href="ggplot.html#statistics-1"><i class="fa fa-check"></i><b>6.2.4</b> Statistics</a></li>
<li class="chapter" data-level="6.2.5" data-path="ggplot.html"><a href="ggplot.html#coordinates"><i class="fa fa-check"></i><b>6.2.5</b> Coordinates</a></li>
<li class="chapter" data-level="6.2.6" data-path="ggplot.html"><a href="ggplot.html#themes"><i class="fa fa-check"></i><b>6.2.6</b> Themes</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="ggplot.html"><a href="ggplot.html#sharing-visualisations"><i class="fa fa-check"></i><b>6.3</b> Sharing visualisations</a></li>
<li class="chapter" data-level="6.4" data-path="ggplot.html"><a href="ggplot.html#assignment"><i class="fa fa-check"></i><b>6.4</b> Assignment</a></li>
<li class="chapter" data-level="6.5" data-path="ggplot.html"><a href="ggplot.html#further-study-4"><i class="fa fa-check"></i><b>6.5</b> Further Study</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="dataproducts.html"><a href="dataproducts.html"><i class="fa fa-check"></i><b>7</b> Creating Data Products</a>
<ul>
<li class="chapter" data-level="7.1" data-path="dataproducts.html"><a href="dataproducts.html#data-science-workflow"><i class="fa fa-check"></i><b>7.1</b> Data Science Workflow</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="dataproducts.html"><a href="dataproducts.html#define"><i class="fa fa-check"></i><b>7.1.1</b> Define</a></li>
<li class="chapter" data-level="7.1.2" data-path="dataproducts.html"><a href="dataproducts.html#prepare"><i class="fa fa-check"></i><b>7.1.2</b> Prepare</a></li>
<li class="chapter" data-level="7.1.3" data-path="dataproducts.html"><a href="dataproducts.html#understand"><i class="fa fa-check"></i><b>7.1.3</b> Understand</a></li>
<li class="chapter" data-level="7.1.4" data-path="dataproducts.html"><a href="dataproducts.html#communicate"><i class="fa fa-check"></i><b>7.1.4</b> Communicate</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="dataproducts.html"><a href="dataproducts.html#reproducible-research"><i class="fa fa-check"></i><b>7.2</b> Reproducible Research</a></li>
<li class="chapter" data-level="7.3" data-path="dataproducts.html"><a href="dataproducts.html#r-markdown"><i class="fa fa-check"></i><b>7.3</b> R-Markdown</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="dataproducts.html"><a href="dataproducts.html#formatting-tables"><i class="fa fa-check"></i><b>7.3.1</b> Formatting tables</a></li>
<li class="chapter" data-level="7.3.2" data-path="dataproducts.html"><a href="dataproducts.html#presenting-numbers"><i class="fa fa-check"></i><b>7.3.2</b> Presenting numbers</a></li>
<li class="chapter" data-level="7.3.3" data-path="dataproducts.html"><a href="dataproducts.html#export-formats"><i class="fa fa-check"></i><b>7.3.3</b> Export formats</a></li>
<li class="chapter" data-level="7.3.4" data-path="dataproducts.html"><a href="dataproducts.html#sharing-results-online"><i class="fa fa-check"></i><b>7.3.4</b> Sharing results online</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="dataproducts.html"><a href="dataproducts.html#mini-hackathon"><i class="fa fa-check"></i><b>7.4</b> Mini Hackathon</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="cleaning.html"><a href="cleaning.html"><i class="fa fa-check"></i><b>8</b> Cleaning Data</a>
<ul>
<li class="chapter" data-level="8.1" data-path="cleaning.html"><a href="cleaning.html#case-study-2"><i class="fa fa-check"></i><b>8.1</b> Case Study 2</a></li>
<li class="chapter" data-level="8.2" data-path="cleaning.html"><a href="cleaning.html#cleaning-data"><i class="fa fa-check"></i><b>8.2</b> Cleaning data</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="cleaning.html"><a href="cleaning.html#load-and-explore-the-data"><i class="fa fa-check"></i><b>8.2.1</b> Load and explore the data</a></li>
<li class="chapter" data-level="8.2.2" data-path="cleaning.html"><a href="cleaning.html#remove-unwanted-responses"><i class="fa fa-check"></i><b>8.2.2</b> Remove unwanted responses</a></li>
<li class="chapter" data-level="8.2.3" data-path="cleaning.html"><a href="cleaning.html#remove-unwanted-variables"><i class="fa fa-check"></i><b>8.2.3</b> Remove unwanted variables</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="cleaning.html"><a href="cleaning.html#joining-data-frames"><i class="fa fa-check"></i><b>8.3</b> Joining data frames</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="cleaning.html"><a href="cleaning.html#writedata"><i class="fa fa-check"></i><b>8.3.1</b> Write data to disk</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="cleaning.html"><a href="cleaning.html#simplifying-code-with-data-pipes"><i class="fa fa-check"></i><b>8.4</b> Simplifying Code with Data Pipes</a></li>
<li class="chapter" data-level="8.5" data-path="cleaning.html"><a href="cleaning.html#quiz-4-cleaning-data"><i class="fa fa-check"></i><b>8.5</b> Quiz 4: Cleaning Data</a></li>
<li class="chapter" data-level="8.6" data-path="cleaning.html"><a href="cleaning.html#further-study-5"><i class="fa fa-check"></i><b>8.6</b> Further Study</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="customers.html"><a href="customers.html"><i class="fa fa-check"></i><b>9</b> Exploring the Customer Experience</a>
<ul>
<li class="chapter" data-level="9.1" data-path="customers.html"><a href="customers.html#consumer-involvement"><i class="fa fa-check"></i><b>9.1</b> Consumer Involvement</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="customers.html"><a href="customers.html#methodology"><i class="fa fa-check"></i><b>9.1.1</b> Methodology</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="customers.html"><a href="customers.html#missing-data"><i class="fa fa-check"></i><b>9.2</b> Missing Data</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="customers.html"><a href="customers.html#imputation"><i class="fa fa-check"></i><b>9.2.1</b> Imputation</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="customers.html"><a href="customers.html#preparing-the-involvement-data"><i class="fa fa-check"></i><b>9.3</b> Preparing the Involvement Data</a></li>
<li class="chapter" data-level="9.4" data-path="customers.html"><a href="customers.html#tidy-data"><i class="fa fa-check"></i><b>9.4</b> Tidy Data</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="customers.html"><a href="customers.html#explore-the-results"><i class="fa fa-check"></i><b>9.4.1</b> Explore the results</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="customers.html"><a href="customers.html#quiz-5-transforming-data"><i class="fa fa-check"></i><b>9.5</b> Quiz 5: Transforming data</a></li>
<li class="chapter" data-level="9.6" data-path="customers.html"><a href="customers.html#quiz-5-transforming-data-1"><i class="fa fa-check"></i><b>9.6</b> Quiz 5: Transforming data</a></li>
<li class="chapter" data-level="9.7" data-path="customers.html"><a href="customers.html#further-study-6"><i class="fa fa-check"></i><b>9.7</b> Further Study</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="analysing-the-customer-experience.html"><a href="analysing-the-customer-experience.html"><i class="fa fa-check"></i><b>10</b> Analysing the customer experience</a>
<ul>
<li class="chapter" data-level="10.1" data-path="analysing-the-customer-experience.html"><a href="analysing-the-customer-experience.html#the-reliability-and-validity-of-surveys"><i class="fa fa-check"></i><b>10.1</b> The Reliability and Validity of Surveys</a></li>
<li class="chapter" data-level="10.2" data-path="analysing-the-customer-experience.html"><a href="analysing-the-customer-experience.html#correlations"><i class="fa fa-check"></i><b>10.2</b> Correlations</a></li>
<li class="chapter" data-level="10.3" data-path="analysing-the-customer-experience.html"><a href="analysing-the-customer-experience.html#hierarchical-clustering-to-assess-validity"><i class="fa fa-check"></i><b>10.3</b> Hierarchical Clustering to assess validity</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="analysing-the-customer-experience.html"><a href="analysing-the-customer-experience.html#pre-processing"><i class="fa fa-check"></i><b>10.3.1</b> Pre-processing</a></li>
<li class="chapter" data-level="10.3.2" data-path="analysing-the-customer-experience.html"><a href="analysing-the-customer-experience.html#scaling"><i class="fa fa-check"></i><b>10.3.2</b> Scaling</a></li>
<li class="chapter" data-level="10.3.3" data-path="analysing-the-customer-experience.html"><a href="analysing-the-customer-experience.html#distances"><i class="fa fa-check"></i><b>10.3.3</b> Distances</a></li>
<li class="chapter" data-level="10.3.4" data-path="analysing-the-customer-experience.html"><a href="analysing-the-customer-experience.html#clustering"><i class="fa fa-check"></i><b>10.3.4</b> Clustering</a></li>
<li class="chapter" data-level="10.3.5" data-path="analysing-the-customer-experience.html"><a href="analysing-the-customer-experience.html#interpreting-the-results"><i class="fa fa-check"></i><b>10.3.5</b> Interpreting the Results</a></li>
<li class="chapter" data-level="10.3.6" data-path="analysing-the-customer-experience.html"><a href="analysing-the-customer-experience.html#clustering-the-involvement-data"><i class="fa fa-check"></i><b>10.3.6</b> Clustering the Involvement Data</a></li>
<li class="chapter" data-level="10.3.7" data-path="analysing-the-customer-experience.html"><a href="analysing-the-customer-experience.html#other-techniques"><i class="fa fa-check"></i><b>10.3.7</b> Other techniques</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="analysing-the-customer-experience.html"><a href="analysing-the-customer-experience.html#reviewing-the-personal-involvement-index"><i class="fa fa-check"></i><b>10.4</b> Reviewing the Personal Involvement Index</a></li>
<li class="chapter" data-level="10.5" data-path="analysing-the-customer-experience.html"><a href="analysing-the-customer-experience.html#quiz"><i class="fa fa-check"></i><b>10.5</b> Quiz</a></li>
<li class="chapter" data-level="10.6" data-path="analysing-the-customer-experience.html"><a href="analysing-the-customer-experience.html#further-study-7"><i class="fa fa-check"></i><b>10.6</b> Further study</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="reporting.html"><a href="reporting.html"><i class="fa fa-check"></i><b>11</b> Writing Reports</a>
<ul>
<li class="chapter" data-level="11.1" data-path="reporting.html"><a href="reporting.html#creating-documents-with-rmarkdown"><i class="fa fa-check"></i><b>11.1</b> Creating documents with RMarkdown</a></li>
<li class="chapter" data-level="11.2" data-path="reporting.html"><a href="reporting.html#survey-items"><i class="fa fa-check"></i><b>11.2</b> Survey Items</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="reporting.html"><a href="reporting.html#customer-characteristics"><i class="fa fa-check"></i><b>11.2.1</b> Customer characteristics</a></li>
<li class="chapter" data-level="11.2.2" data-path="reporting.html"><a href="reporting.html#service-quality"><i class="fa fa-check"></i><b>11.2.2</b> Service quality</a></li>
<li class="chapter" data-level="11.2.3" data-path="reporting.html"><a href="reporting.html#technical-quality"><i class="fa fa-check"></i><b>11.2.3</b> Technical Quality</a></li>
<li class="chapter" data-level="11.2.4" data-path="reporting.html"><a href="reporting.html#functional-quality-questions"><i class="fa fa-check"></i><b>11.2.4</b> Functional Quality Questions</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="reporting.html"><a href="reporting.html#mini-hackathon-1"><i class="fa fa-check"></i><b>11.3</b> Mini Hackathon</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="reporting.html"><a href="reporting.html#data-cleaning"><i class="fa fa-check"></i><b>11.3.1</b> Data Cleaning</a></li>
<li class="chapter" data-level="11.3.2" data-path="reporting.html"><a href="reporting.html#data-exploration"><i class="fa fa-check"></i><b>11.3.2</b> Data Exploration</a></li>
<li class="chapter" data-level="11.3.3" data-path="reporting.html"><a href="reporting.html#data-analysis"><i class="fa fa-check"></i><b>11.3.3</b> Data Analysis</a></li>
<li class="chapter" data-level="11.3.4" data-path="reporting.html"><a href="reporting.html#write-a-report"><i class="fa fa-check"></i><b>11.3.4</b> Write a report</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="close.html"><a href="close.html"><i class="fa fa-check"></i><b>12</b> In Closing</a>
<ul>
<li class="chapter" data-level="12.1" data-path="close.html"><a href="close.html#searching-for-answers"><i class="fa fa-check"></i><b>12.1</b> Searching for answers</a></li>
<li class="chapter" data-level="12.2" data-path="close.html"><a href="close.html#forums"><i class="fa fa-check"></i><b>12.2</b> Forums</a></li>
<li class="chapter" data-level="12.3" data-path="close.html"><a href="close.html#further-study-8"><i class="fa fa-check"></i><b>12.3</b> Further Study</a></li>
<li class="chapter" data-level="12.4" data-path="close.html"><a href="close.html#thanks"><i class="fa fa-check"></i><b>12.4</b> Thanks</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i>Appendix</a>
<ul>
<li class="chapter" data-level="12.5" data-path="appendix.html"><a href="appendix.html#quiz1"><i class="fa fa-check"></i><b>12.5</b> Answers to Quiz 1</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="appendix.html"><a href="appendix.html#question-1"><i class="fa fa-check"></i><b>12.5.1</b> Question 1</a></li>
<li class="chapter" data-level="12.5.2" data-path="appendix.html"><a href="appendix.html#question-2"><i class="fa fa-check"></i><b>12.5.2</b> Question 2</a></li>
<li class="chapter" data-level="12.5.3" data-path="appendix.html"><a href="appendix.html#question-3"><i class="fa fa-check"></i><b>12.5.3</b> Question 3</a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="appendix.html"><a href="appendix.html#quiz2"><i class="fa fa-check"></i><b>12.6</b> Answers to Quiz 2</a>
<ul>
<li class="chapter" data-level="12.6.1" data-path="appendix.html"><a href="appendix.html#question-1-1"><i class="fa fa-check"></i><b>12.6.1</b> Question 1</a></li>
<li class="chapter" data-level="12.6.2" data-path="appendix.html"><a href="appendix.html#question-2-1"><i class="fa fa-check"></i><b>12.6.2</b> Question 2</a></li>
<li class="chapter" data-level="12.6.3" data-path="appendix.html"><a href="appendix.html#question-3-1"><i class="fa fa-check"></i><b>12.6.3</b> Question 3</a></li>
<li class="chapter" data-level="12.6.4" data-path="appendix.html"><a href="appendix.html#question-4"><i class="fa fa-check"></i><b>12.6.4</b> Question 4</a></li>
<li class="chapter" data-level="12.6.5" data-path="appendix.html"><a href="appendix.html#question-5"><i class="fa fa-check"></i><b>12.6.5</b> Question 5</a></li>
</ul></li>
<li class="chapter" data-level="12.7" data-path="appendix.html"><a href="appendix.html#answers-to-quiz-3"><i class="fa fa-check"></i><b>12.7</b> Answers to Quiz 3</a></li>
<li class="chapter" data-level="12.8" data-path="appendix.html"><a href="appendix.html#answers-to-quiz-4"><i class="fa fa-check"></i><b>12.8</b> Answers to Quiz 4</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://peterprevos.com/" target="blank">Dr Peter Prevos</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Science for Water Professionals - Create Value from Data with the R Language</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cleaning" class="section level1" number="8">
<h1><span class="header-section-number">Chapter 8</span> Cleaning Data</h1>
<p>The data that we used in the first case study was perfect in many ways. There were no superfluous columns or missing observations, and everything was perfectly labelled, ready to be analysed. Data in the real world is, however, not always this clean. This chapter introduces some techniques to clean data with R and the Tidyverse to create reproducible code.</p>
<p>The learning objectives for this session are:
* Select and rename columns in a data frame.
* Join data frames.
* Use piped code for greater efficiency.</p>
<p>The data and code for this session are available in the <code>chapter_08.R</code> file in the <code>casestudy2</code> folder of your RStudio project.</p>
<div id="case-study-2" class="section level2" number="8.1">
<h2><span class="header-section-number">8.1</span> Case Study 2</h2>
<p>The case study for the next four chapters uses data obtained from a sample of customers in three Gormsey towns. The Gormsey water utility decided that it would be good to know how the people of Gormsey feel about their water services. A random sample of consumers in three towns completed a series of questions.</p>
<p>The customer experience manager has two questions:
1. How much do people care about the service that Gormsey water utility provides?
2. How satisfied are the people of Gormsey are with their service provider?</p>
<p>The survey that includes a series of questions from a sample of customers in three towns. The results of the survey are stored in a CSV file. Your task over the next four sessions is to analyse the results of this survey and produce a written report.</p>
<p>The data used in this case study is taken from a PhD research project about customer-centricity for water utilities. If you are interested reading more about a scientific view of customer experience in water utilities, then you can read <em>Customer Experience Management for Water Utilities</em> by Peter Prevos, available from <a href="https://www.iwapublishing.com/books/9781780408668/customer-experience-management-water-utilities-marketing-urban-water-supply">IWA Publishing</a>.</p>
</div>
<div id="cleaning-data" class="section level2" number="8.2">
<h2><span class="header-section-number">8.2</span> Cleaning data</h2>
<p>Many data science practitioners know that cleaning data can consume 80% of the available time. Cleaning data is fundamental because even the most advanced algorithm cannot create value from dirty data. As the old adagio goes: “rubbish-in is rubbish-out”. The following code snippets show how to clean this survey data using reproducible code.</p>
<p>Using code to clean data is better than to manually manipulate data in Excel because with code, the process of changing the data is transparent, and the original raw data still exists. The process can always be rolled back. Using code to clean data is also reproducible because it can be repeated with other raw data sets that have the same structure.</p>
<div id="load-and-explore-the-data" class="section level3" number="8.2.1">
<h3><span class="header-section-number">8.2.1</span> Load and explore the data</h3>
<p>The results of the survey are stored in the <code>casestudy2</code> folder in the <code>customer_survey.csv</code> file. This data is the raw data as collected from the online survey system.</p>
<blockquote>
<p>Open a new R script and load the data. Explore the content with some of the techniques you have learned so far.</p>
</blockquote>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="cleaning.html#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb104-2"><a href="cleaning.html#cb104-2" aria-hidden="true" tabindex="-1"></a>rawdata  <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;casestudy2/customer_survey.csv&quot;</span>)</span>
<span id="cb104-3"><a href="cleaning.html#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(rawdata)</span></code></pre></div>
<p>We use <code>rawdata</code> as the variable name because we want to keep this data intact as we process it, in case we need to use it again.</p>
<p>The output of the <code>glimpse()</code> function shows that this data contains over fifty variables. You will note that the class of all variables in the raw data is a character.</p>
<blockquote>
<p>How many rows and columns of data does this data have? Which fields are useful?</p>
</blockquote>
<p>The output of the <code>glimpse()</code> function shows that the first 19 columns contain metadata, such as a unique response ID, internet addresses, start and end times, and so on. The next 35 columns contain the actual data.</p>
<p>Looking at the data with the <code>View()</code> function, we see that the first two rows contain header information. Many data files contain more than one header row, or they contain meta information at the bottom, such as totals or other calculations. A clean data set should have only one header row and not contain any data summaries. Because of the double headers, R thinks that all columns are text. The code below shows the content of the first two rows as a data frame.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="cleaning.html#cb105-1" aria-hidden="true" tabindex="-1"></a>questions <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;casestudy2/customer_survey.csv&quot;</span>, <span class="at">n_max =</span> <span class="dv">2</span>, <span class="at">col_names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb105-2"><a href="cleaning.html#cb105-2" aria-hidden="true" tabindex="-1"></a>questions <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(questions), <span class="at">row.names =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p>The <em>readr</em> package assumes that the first for contains the variable names by default. This code reads the first two rows <code>n_max = 2</code> and ignores the column names. R will assign neutral column names. The<code>t()</code> function transposes (rotates) the data so that the rows become columns. By setting the row names at <code>NULL</code>, the generated names are ignored. The columns in this data frame are the first two rows in the raw data. This method makes it easy to review the two names for each column.</p>
<p>From the result of this code, you can clearly see that the first row in the raw data contains the questions as they appeared on the survey, while the second row contains abbreviated variable names. We thus need to remove the first row and re-assess the data types to create a clean table.</p>
<p>The first line of code creates the new <code>customers</code> data frame by removing the first line of the raw data, which includes the questions. Using negative numbers in data frame indices removes them from the output.</p>
<p>The <code>type_convert()</code> function re-assesses the variables to guess the correct data types. Using the <code>glimpse()</code> function again, we can see that most columns are now numerical values, which is what we want them to be.</p>
</div>
<div id="remove-unwanted-responses" class="section level3" number="8.2.2">
<h3><span class="header-section-number">8.2.2</span> Remove unwanted responses</h3>
<p>The next step is to remove any respondents that either:</p>
<ul>
<li>Did not consent to their data being used.</li>
<li>Do not have tap water.</li>
<li>Do not live in one of the three nominated towns.</li>
<li>Did not pay attention when completing the survey.</li>
</ul>
<p>The first question on the survey ask for consent to use the responses. Informed consent is the first principle of ethical data science. The survey also asks whether the respondent has tap water and which city they live in. One of the problems with using paid survey subjects is that they are motivated to complete many surveys, without having much regard for their answers. Respondents were therefore also subjected to an attention filter: “If you live in Gormsey then select Strongly Agree”. The survey was only sent to people within Gormsey. Respondents who did not answer “Strongly Agree” should thus be excluded from the data.</p>
<p>The <code>term</code> field reports why a respondent terminated the survey and whether they paid attention. To summarise the content of this field, we can use the <code>table()</code> function. This function creates, as expected, a table with a count of the unique elements in a vector.</p>
<p>The output of this function shows that 79 people did not pass through the attention filter, 8 did not consent, 15 did not have tap water, and 97 lived outside Gormsey.</p>
<p>You might notice that the total number of items in the table does not match the number of rows (observations) in the data frame. When you view the content of the <code>customers$term</code> field, you see many entries with <code>NA</code> in them. These are empty values (Not Available). R uses this method to manage missing values. The table function can include <code>NA</code> values with the <code>useNA = "ifany"</code> option:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="cleaning.html#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(customers<span class="sc">$</span>term, <span class="at">useNA =</span> <span class="st">&quot;ifany&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  attention    consent noTapWater  otherCity       &lt;NA&gt; 
##         79          8         15         97        491</code></pre>
<p>The <code>table()</code> function forms part of the core R functionality. In the previous case study, we already saw the <code>count()</code> function of the Tidyverse. This function includes <code>NA</code> values. Another advantage of this function is that the output is a data frame, which we can use for further calculations or visualise with ggplot.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="cleaning.html#cb108-1" aria-hidden="true" tabindex="-1"></a>term <span class="ot">&lt;-</span> <span class="fu">count</span>(customers, term)</span>
<span id="cb108-2"><a href="cleaning.html#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(term, <span class="fu">aes</span>(term, n)) <span class="sc">+</span></span>
<span id="cb108-3"><a href="cleaning.html#cb108-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span> </span>
<span id="cb108-4"><a href="cleaning.html#cb108-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Responses to termination field&quot;</span>) <span class="sc">+</span> </span>
<span id="cb108-5"><a href="cleaning.html#cb108-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-67"></span>
<img src="r4h2o_files/figure-html/unnamed-chunk-67-1.png" alt="Responses to termination field." width="672" />
<p class="caption">
Figure 8.1: Responses to termination field.
</p>
</div>
<p>We only want those rows of data that have an <code>NA</code> value in the <code>term</code> field, as these are the surveys that were not terminated. To find these observations, we need to use a special function. The <code>is.na()</code> function results in a logical variable (<code>TRUE</code> or <code>FALSE</code>) that shows whether a field is not available. Try <code>is.na(customers$term)</code> to see the result. The next line of code filters the customer data by only those that have <code>NA</code> in the <code>term</code> field. You cannot use <code>term == NA</code> because this is a special condition. More about <code>NA</code> values in the next session.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="cleaning.html#cb109-1" aria-hidden="true" tabindex="-1"></a>customers <span class="ot">&lt;-</span> <span class="fu">filter</span>(customers, <span class="fu">is.na</span>(term))</span></code></pre></div>
<p>To see all respondents that did not complete the survey, you can negate the <code>is.na(term)</code> statement with an exclamation mark (the NOT function): <code>filter(customers, !is.na(term))</code>. We are thus asking R to filter the customer data frame for all entries where <code>term</code> is not (<code>!</code>) not available (<code>NA</code>).</p>
</div>
<div id="remove-unwanted-variables" class="section level3" number="8.2.3">
<h3><span class="header-section-number">8.2.3</span> Remove unwanted variables</h3>
<p>The survey data contains metadata that we do not need for further analysis. The first 19 columns contain information about when the survey was taken and so on. The next step is to remove the metadata and the <code>trap</code> question, which was used as the attention filter.</p>
<p>In the dplyr package, the <code>select()</code> function works just like the filter function, but for columns. You can use numbers or names to indicate the required columns (negative numbers remove a column). In this case, we like to keep the first column, which is the unique id for each respondent, and the columns with the city id and survey responses, excluding the attention question.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="cleaning.html#cb110-1" aria-hidden="true" tabindex="-1"></a>customers <span class="ot">&lt;-</span> <span class="fu">select</span>(customers, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">19</span>, <span class="dv">21</span><span class="sc">:</span><span class="dv">51</span>, <span class="sc">-</span><span class="dv">33</span>))</span></code></pre></div>
<p>The penultimate step is to improve the name of the first variable <code>V1</code>. We like to rename this to <code>survey_id</code> because that is a bit more descriptive. The names of the other variables (<code>p01</code> etc.) seem cryptic, but they will be explained in the <a href="customers.html#customers">next chapter</a>. The <code>questions</code> variable contains the questions that resulted in the answers for each variable.</p>
<p>The <code>rename()</code> function from the dplyr package changes, as the name suggests, the name of variables in a data frame.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="cleaning.html#cb111-1" aria-hidden="true" tabindex="-1"></a>customers <span class="ot">&lt;-</span> <span class="fu">rename</span>(customers, <span class="at">survey_id =</span> V1)</span></code></pre></div>
</div>
</div>
<div id="joining-data-frames" class="section level2" number="8.3">
<h2><span class="header-section-number">8.3</span> Joining data frames</h2>
<p>The last step is to replace the number for the towns in the <code>city</code> variable, which is either 1, 2 or 3 and not very descriptive. We do this by merging the data with a dimension table. This table contains the relationship between the numbers and the names of the towns. In this case study, the three surveyed villages are:</p>
<ol style="list-style-type: decimal">
<li>Merton</li>
<li>Snake’s Canyon</li>
<li>Wakefield</li>
</ol>
<p>Databases have two types of tables. Fact tables contain the actual data and dimension table provide context for this data. Dimension tables are often needed in surveys that have drop-down boxes to provide answers as the data is usually stored as numbers.</p>
<p>First, we create the control table to link the numbers with towns, which is then joined to the primary data. Note how the first function call is split over several lines to enhance its readability.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="cleaning.html#cb112-1" aria-hidden="true" tabindex="-1"></a>cities <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">city =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb112-2"><a href="cleaning.html#cb112-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">city_name =</span> <span class="fu">c</span>(<span class="st">&quot;Merton&quot;</span>, <span class="st">&quot;Snake&#39;s Canyon&quot;</span>, <span class="st">&quot;Wakefield&quot;</span>))</span>
<span id="cb112-3"><a href="cleaning.html#cb112-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-4"><a href="cleaning.html#cb112-4" aria-hidden="true" tabindex="-1"></a>customers <span class="ot">&lt;-</span> <span class="fu">left_join</span>(customers, cities)</span></code></pre></div>
<p>The <code>left_join()</code> function finds the matching fields in the two sets and then merges the sets. You can specify the specific column names with the <code>by = "city"</code> option. Since both data frames have a variable named <code>city</code>, the function automatically matches these fields. This function keeps all the values in the left data set (the survey results) while linking it with the data in the second data frame (the cities).</p>
<p>This function returns all rows from the first tibble (<code>customers</code>), and all columns from both tibbles (<code>customers</code> and <code>cities</code>). Rows in <code>customers</code> with no match in <code>cities</code> will have <code>NA</code> values in the <code>city_name</code> column. If there are multiple matches, all combinations of the matches are returned.</p>
<p>If one of the city variables in the customer data contains a number that is not in the dimension table, the <code>city_name</code> variable becomes <code>NA</code>. If the dimension table has missing matching references, the result is also <code>NA</code>.</p>
<p>The <code>left_join()</code> function is the most common way to join two data sets. The Tidyverse has several other <a href="https://dplyr.tidyverse.org/reference/join.html">join functions</a> that match values in different ways (Figure <a href="cleaning.html#fig:join">8.2</a>).</p>
<div class="figure"><span style="display:block;" id="fig:join"></span>
<img src="images/dplyr-join.png" alt="Schematic view of the dplyr join functions" width="60%" />
<p class="caption">
Figure 8.2: Schematic view of the dplyr join functions
</p>
</div>
<div id="writedata" class="section level3" number="8.3.1">
<h3><span class="header-section-number">8.3.1</span> Write data to disk</h3>
<p>We now have a clean data frame that we can use in further analysis. The last step saves this data to disc so that we can reuse it in the following sessions.</p>
<p>The <code>write_csv()</code> function takes a data frame and saves it s a CSV file to the specified filename. Best practice is to not change the raw data and use a different name. Keeping the raw data intact means that your code is reproducible and you can always go back to the original state.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="cleaning.html#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(customers, <span class="st">&quot;casestudy2/customer_survey_clean.csv&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="simplifying-code-with-data-pipes" class="section level2" number="8.4">
<h2><span class="header-section-number">8.4</span> Simplifying Code with Data Pipes</h2>
<p>The sequence of functions explained above cleans the data for further analysis from the raw data to the finished product. The benefit of this approach is that the raw data remains unchanged so that we can use this code also on other survey results with the same data structure.</p>
<p>However, the code is repetitive because we change the <code>customers</code> variable several times in a sequence. In summary, we have taken the following steps to clean the data:</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="cleaning.html#cb114-1" aria-hidden="true" tabindex="-1"></a>customers <span class="ot">&lt;-</span> rawdata[<span class="sc">-</span><span class="dv">1</span>, ]                            <span class="co"># Remove first row</span></span>
<span id="cb114-2"><a href="cleaning.html#cb114-2" aria-hidden="true" tabindex="-1"></a>customers <span class="ot">&lt;-</span> <span class="fu">type_convert</span>(customers)                  <span class="co"># Convert variable types</span></span>
<span id="cb114-3"><a href="cleaning.html#cb114-3" aria-hidden="true" tabindex="-1"></a>customers <span class="ot">&lt;-</span> <span class="fu">filter</span>(customers, <span class="fu">is.na</span>(term))           <span class="co"># Remove terminated respondents</span></span>
<span id="cb114-4"><a href="cleaning.html#cb114-4" aria-hidden="true" tabindex="-1"></a>customers <span class="ot">&lt;-</span> <span class="fu">select</span>(customers, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">19</span>, <span class="dv">21</span><span class="sc">:</span><span class="dv">51</span>, <span class="sc">-</span><span class="dv">33</span>))  <span class="co"># Select relevant variables</span></span>
<span id="cb114-5"><a href="cleaning.html#cb114-5" aria-hidden="true" tabindex="-1"></a>customers <span class="ot">&lt;-</span> <span class="fu">rename</span>(customers, <span class="at">id =</span> V1)               <span class="co"># Rename first column</span></span>
<span id="cb114-6"><a href="cleaning.html#cb114-6" aria-hidden="true" tabindex="-1"></a>customers <span class="ot">&lt;-</span> <span class="fu">left_join</span>(customers, cities)             <span class="co"># Joing city names</span></span></code></pre></div>
<p>A rule-of-thumb in coding is that if you repeat the same thing more than twice, there will be a more efficient way of achieving the same result. In this example, we used “<code>customer &lt;-</code>” six times. There are two ways of combining these lines of code.</p>
<p>A typical way to code in a spreadsheet is to join the steps in a nested formula. While the nested approach uses less space, it is not as easy to understand because you have to read from the inside out.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="cleaning.html#cb115-1" aria-hidden="true" tabindex="-1"></a>customers <span class="ot">&lt;-</span> <span class="fu">rename</span>(<span class="fu">select</span>(<span class="fu">left_join</span>(<span class="fu">filter</span>(<span class="fu">type_convert</span>(rawdata[<span class="sc">-</span><span class="dv">1</span>, ]), <span class="fu">is.na</span>(term)), cities), <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">19</span>, <span class="dv">21</span><span class="sc">:</span><span class="dv">51</span>, <span class="sc">-</span><span class="dv">33</span>)), <span class="at">survey_id =</span> V1)</span></code></pre></div>
<p>The <a href="https://magrittr.tidyverse.org/">Magrittr package</a> within the Tidyverse uses the pipe operator to streamline this process. A pipe transports the output of one function to the input of the next one. A pipe replaces <code>f(x)</code> with <code>x %&gt;% f()</code>, where <code>%&gt;%</code> is the pipe-operator. This code means that R pipes the value of <code>x</code> to the function <code>f()</code>. This step can be repeated in a long sequence. The code used to clean the customer data is now written like this:</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="cleaning.html#cb116-1" aria-hidden="true" tabindex="-1"></a>customers <span class="ot">&lt;-</span> rawdata[<span class="sc">-</span><span class="dv">1</span>, ] <span class="sc">%&gt;%</span></span>
<span id="cb116-2"><a href="cleaning.html#cb116-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">type_convert</span>() <span class="sc">%&gt;%</span></span>
<span id="cb116-3"><a href="cleaning.html#cb116-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">is.na</span>(term)) <span class="sc">%&gt;%</span></span>
<span id="cb116-4"><a href="cleaning.html#cb116-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">19</span>, <span class="dv">21</span><span class="sc">:</span><span class="dv">51</span>, <span class="sc">-</span><span class="dv">33</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb116-5"><a href="cleaning.html#cb116-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">survey_id =</span> V1) <span class="sc">%&gt;%</span></span>
<span id="cb116-6"><a href="cleaning.html#cb116-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(cities)</span></code></pre></div>
<p>The raw data without the first row is piped to the type converter. The output from this step goes to the filter, onward to the select function, and so on. The name of the customers variable only appears once because it is transported through the pipe. The pipe operator always moves the output of the previous step to the first parameters in the next function.</p>
<p>The best way to understand this piped code is to evaluate it step by step and review the output. You can select bits of the code and run them separately.</p>
<blockquote>
<p>Review the code below from <a href="#analyse">chapter 5</a> and rewrite it as a pipe.</p>
</blockquote>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="cleaning.html#cb117-1" aria-hidden="true" tabindex="-1"></a>gormsey <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;casestudy1/gormsey.csv&quot;</span>)</span>
<span id="cb117-2"><a href="cleaning.html#cb117-2" aria-hidden="true" tabindex="-1"></a>gormsey_grouped <span class="ot">&lt;-</span> <span class="fu">group_by</span>(gormsey, Town, Measure)</span>
<span id="cb117-3"><a href="cleaning.html#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(gormsey_grouped, <span class="at">mean =</span> <span class="fu">mean</span>(Result))</span></code></pre></div>
<p>You need to add a pipe symbol to the end of the first line and remove the repeated call of the <code>gormsey_grouped</code> variable:</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="cleaning.html#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="st">&quot;casestudy1/gormsey.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb118-2"><a href="cleaning.html#cb118-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Town, Measure)  <span class="sc">%&gt;%</span></span>
<span id="cb118-3"><a href="cleaning.html#cb118-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(Result))</span></code></pre></div>
<pre><code>## # A tibble: 33 × 3
## # Groups:   Town [11]
##    Town        Measure      mean
##    &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;
##  1 Bellmoral   E. coli   0      
##  2 Bellmoral   THM       0.0177 
##  3 Bellmoral   Turbidity 0.148  
##  4 Blancathey  E. coli   0.00429
##  5 Blancathey  THM       0.0166 
##  6 Blancathey  Turbidity 0.153  
##  7 Merton      E. coli   0      
##  8 Merton      THM       0.0425 
##  9 Merton      Turbidity 0.147  
## 10 Paethsmouth E. coli   0      
## # … with 23 more rows</code></pre>
<p>We now have a reproducible script that can be reused every time we run this same survey. This approach promotes the reproducibility of the analysis and allows for peer review of the investigation to assure its soundness.</p>
<p>Now that we have a clean set of data and some new knowledge, it is time for another quiz.</p>
</div>
<div id="quiz-4-cleaning-data" class="section level2" number="8.5">
<h2><span class="header-section-number">8.5</span> Quiz 4: Cleaning Data</h2>
<p>The fourth quiz has five questions to practice the content of this chapter.</p>
<p>The following five questions test your comprehension of some of the functionality explained in this chapter. Test your answer by executing the code in the console. Any files, including the solutions, are available in the <code>casestudy2</code> folder.</p>
<blockquote>
<p>You receive a CSV file from a colleague. The first five rows of this data look like the table below. How do you read this CSV file into memory?</p>
</blockquote>
<pre><code>This file contains lots of data.
id  Date       Measurement Type
a1  2020-12-02        12.3   A
a2  2020-12-03         7.6   A
a3  2020-12-04         2.3   B</code></pre>
<ol style="list-style-type: lower-alpha">
<li><code>read_csv("casestudy2/quiz_04.csv")</code></li>
<li><code>read_csv("casestudy2/quiz_04.csv", skip = 1)</code></li>
<li><code>read_csv("casestudy2/quiz_04.csv", n_max = 1)</code></li>
<li><code>read_csv("casestudy2/quiz_04.csv", skip = 1, n_max = 2)</code></li>
</ol>
<blockquote>
<p>You want to write a single piece of code that reads the CSV file from the previous question and removes the second column. What is the most efficient method to achieve this?</p>
</blockquote>
<ol style="list-style-type: lower-alpha">
<li><code>read_csv("casestudy2/quiz4.csv", skip = 1) %&gt;% select(-2)</code></li>
<li><code>select(read_csv("casestudy2/quiz4.csv", skip = 1), -2)</code></li>
<li><code>read_csv("casestudy2/quiz4.csv"); df &lt;- select(df, -2)</code></li>
<li><code>read_csv("casestudy2/quiz4.csv"), select(-2)</code></li>
</ol>
<p>The <code>casestudy2</code> folder also contains the results of an employee survey. This survey asks some questions about their attitudes towards marketing. You need to write some code to clean this data so that you can answer the following questions:</p>
<blockquote>
<p>How many employees did <em>not</em> consent to the survey (analyse the <code>consent</code> variable)?</p>
</blockquote>
<ol style="list-style-type: lower-alpha">
<li>184</li>
<li>1</li>
<li>0</li>
<li>185</li>
</ol>
<blockquote>
<p>The <code>engineer</code> variable in the employee data indicates whether a respondent has engineering qualifications. The <code>marketing</code> variable indicates that a respondent has marketing or customer service qualifications.</p>
</blockquote>
<blockquote>
<p>How many respondents have both engineering and marketing qualifications?</p>
</blockquote>
<ol style="list-style-type: lower-alpha">
<li>9</li>
<li>0</li>
<li>3</li>
<li>184</li>
</ol>
<blockquote>
<p>You want to visualise the number of employees per department. Complete the following <code>ggplot()</code> function that produces this result:</p>
</blockquote>
<p>{width: 60%, align: “center”}
<img src="images/employees.png" alt="Figure 8.1: Employees per department" /></p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="cleaning.html#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(employees, <span class="fu">aes</span>(department)) <span class="sc">+</span> <span class="st">`</span></span>
<span id="cb121-2"><a href="cleaning.html#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="at">  geom_...()</span></span></code></pre></div>
<ol style="list-style-type: lower-alpha">
<li><code>boxplot</code></li>
<li><code>histogram</code></li>
<li><code>column</code></li>
</ol>
<ol start="4" style="list-style-type: upper-alpha">
<li><code>bar</code></li>
</ol>
<p>That is it for the fourth quiz. If you get stuck, you can find the answers in the <code>quiz_04.R</code> file in the <code>casestudy2</code> folder. You can also watch the video to see the solutions.</p>
</div>
<div id="further-study-5" class="section level2" number="8.6">
<h2><span class="header-section-number">8.6</span> Further Study</h2>
<p>In the <a href="customers.html#customers">next chapter</a>, we further analyse the personal involvement data with some advanced techniques.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="dataproducts.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="customers.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/pprevos/r4h2o/edit/master/08_cleaning_data.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/pprevos/r4h2o/blob/master/08_cleaning_data.Rmd",
"text": null
},
"download": ["r4h2o.pdf", "r4h2o.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
